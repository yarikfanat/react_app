(this.webpackJsonpreact_app=this.webpackJsonpreact_app||[]).push([[0],{439:function(e,t,n){},441:function(e,t,n){},442:function(e,t,n){},443:function(e,t,n){},444:function(e,t,n){},445:function(e,t,n){"use strict";n.r(t);n(199),n(252);var i=n(21),s=n(96),a=n.n(s),o=n(33),c=n(34),r=n(2),l=n(36),h=n(35),d=n(37),u=n.n(d),v=n(58),p=n(13),m=(n(439),n(0));function b(e){return Object(m.jsx)("ul",{className:"userslistbox",children:e.children})}var g=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).scrollWindow=i.scrollWindow.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"componentDidUpdate",value:function(e){this.scrollWindow()}},{key:"scrollWindow",value:function(){var e=this.chatWindow.scrollHeight-this.chatWindow.clientHeight;this.chatWindow.scrollTop=e>0?e:0}},{key:"render",value:function(){var e=this;return Object(m.jsx)("div",{className:"chat_window",ref:function(t){e.chatWindow=t},children:this.props.children})}}]),n}(i.Component),j=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={input_text:"",chat_text:[],user_list:null,state_class:"state_indicator_off",Msg:null,isChat:null,isDockPanel:" ",target_user:null,alertMsg:null,videoMsg:null,closeMsg:null},i.serverUrl="",i.webSocket=null,i.isAlive=!1,i.isControlsDisabled=!0,i.target_user=null,i.msg_connect={type:"connect_user",user_name:null,func:null},i.myUsername=i.props.user_name,i.countUpdate=0,i.typeChat="",i.webcamStream=null,i.mediaConstraints={audio:!0,video:{aspectRatio:{ideal:1.33}}},i.myPeerConnection=null,i.receiveVideo=null,i.localVideo=null,i.videoWidth=0,i.videoHeight=0,i.onChangeText=i.onChangeText.bind(Object(r.a)(i)),i.onClickSend=i.onClickSend.bind(Object(r.a)(i)),i.handlerKey=i.handlerKey.bind(Object(r.a)(i)),i.AnimationEnd=i.AnimationEnd.bind(Object(r.a)(i)),i.AnimationEndDock=i.AnimationEndDock.bind(Object(r.a)(i)),i.chatClose=i.chatClose.bind(Object(r.a)(i)),i.undockVideoPanel=i.undockVideoPanel.bind(Object(r.a)(i)),i.dockVideoPanel=i.dockVideoPanel.bind(Object(r.a)(i)),i.log=i.log.bind(Object(r.a)(i)),i.log_error=i.log_error.bind(Object(r.a)(i)),i.reportError=i.reportError.bind(Object(r.a)(i)),i.connect=i.connect.bind(Object(r.a)(i)),i.ReconnectChat=i.ReconnectChat.bind(Object(r.a)(i)),i.onOpenConnection=i.onOpenConnection.bind(Object(r.a)(i)),i.onMessage=i.onMessage.bind(Object(r.a)(i)),i.sendToServer=i.sendToServer.bind(Object(r.a)(i)),i.CheckConnection=i.CheckConnection.bind(Object(r.a)(i)),i.CreateUserList=i.CreateUserList.bind(Object(r.a)(i)),i.invite=i.invite.bind(Object(r.a)(i)),i.createPeerConnection=i.createPeerConnection.bind(Object(r.a)(i)),i.handleGetUserMediaError=i.handleGetUserMediaError.bind(Object(r.a)(i)),i.handleICECandidateEvent=i.handleICECandidateEvent.bind(Object(r.a)(i)),i.handleICEConnectionStateChangeEvent=i.handleICEConnectionStateChangeEvent.bind(Object(r.a)(i)),i.handleICEGatheringStateChangeEvent=i.handleICEGatheringStateChangeEvent.bind(Object(r.a)(i)),i.handleSignalingStateChangeEvent=i.handleSignalingStateChangeEvent.bind(Object(r.a)(i)),i.handleNegotiationNeededEvent=i.handleNegotiationNeededEvent.bind(Object(r.a)(i)),i.handleVideoOfferMsg=i.handleVideoOfferMsg.bind(Object(r.a)(i)),i.handleVideoAnswerMsg=i.handleVideoAnswerMsg.bind(Object(r.a)(i)),i.handleTrackEvent=i.handleTrackEvent.bind(Object(r.a)(i)),i.closeVideoCall=i.closeVideoCall.bind(Object(r.a)(i)),i.handleHangUpMsg=i.handleHangUpMsg.bind(Object(r.a)(i)),i.hangUpCall=i.hangUpCall.bind(Object(r.a)(i)),i.videoCall=i.videoCall.bind(Object(r.a)(i)),i.reInvite=i.reInvite.bind(Object(r.a)(i)),i.closeVideoChat=i.closeVideoChat.bind(Object(r.a)(i)),i.onResize=i.onResize.bind(Object(r.a)(i)),i.applyAspectRatio=i.applyAspectRatio.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"onResize",value:function(e){this.videoHeight=this.receiveVideo.clientHeight,this.videoWidth=this.receiveVideo.clientWidth,console.log("new width=",this.videoWidth,"new height=",this.videoHeight),this.applyAspectRatio()}},{key:"AnimationEnd",value:function(){this.msg_connect.user_name||"show"!=this.state.isChat||" "!=this.state.isDockPanel||this.setState({Msg:"\u041d\u0435\u0442 \u0441\u0432\u044f\u0437\u0438 \u0441 WebSocket \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438\u043b\u0438 \u043e\u043d \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d. \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u043a\u0443?"}),"close"==this.state.isChat&&this.props.render()}},{key:"AnimationEndDock",value:function(){"undock"==this.state.isDockPanel&&this.setState({isDockPanel:null}),"dock"==this.state.isDockPanel&&this.setState({isDockPanel:" "}),"close"==this.state.isChat&&this.props.render()}},{key:"dockVideoPanel",value:function(){" "!=this.state.isDockPanel&&this.setState({isDockPanel:"dock"})}},{key:"undockVideoPanel",value:function(){this.setState({isDockPanel:"undock"})}},{key:"componentDidUpdate",value:function(e){var t=this;"show"==this.state.isChat&&(p.isIE||p.isEdge)&&!this.msg_connect.user_name&&this.countUpdate<2&&2==++this.countUpdate&&this.setState({Msg:"\u041d\u0435\u0442 \u0441\u0432\u044f\u0437\u0438 \u0441 WebSocket \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0438\u043b\u0438 \u043e\u043d \u0432\u044b\u043a\u043b\u044e\u0447\u0435\u043d. \u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u043a\u0443?"}),"close"==this.state.isChat&&(p.isIE||p.isEdge)&&setTimeout((function(){t.props.render()}),1500),"videoChat"!=this.typeChat||this.videoHeight||this.videoWidth||(this.videoHeight=this.receiveVideo.clientHeight,this.videoWidth=this.receiveVideo.clientWidth,console.log("start width=",this.videoWidth,"start height=",this.videoHeight))}},{key:"componentDidMount",value:function(){this.typeChat=this.props.typeChat,"videoChat"==this.typeChat&&window.addEventListener("resize",this.onResize),this.setState({isChat:"show"}),this.webSocket||this.connect()}},{key:"componentWillUnmount",value:function(){"videoChat"==this.typeChat&&window.removeEventListener("resize",this.onResize)}},{key:"chatClose",value:function(){"videoChat"==this.typeChat&&this.myPeerConnection?this.setState({closeMsg:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0432\u0438\u0434\u0435\u043e\u0447\u0430\u0442 \u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0432\u0438\u0434\u0435\u043e\u0441\u0432\u044f\u0437\u044c?"}):(null!=this.webSocket&&this.webSocket.close(),clearInterval(this.checkAlive),this.setState({isChat:"close"}))}},{key:"onChangeText",value:function(e){this.setState({input_text:e.target.value})}},{key:"onClickSend",value:function(e){var t=this.state.input_text,n={type:"message_touser",text:t,target:this.target_user,from_user:this.props.user_name};if(""!=t){this.sendToServer(n);var i=this.state.chat_text.map((function(e){return e})),s=new Date,a=s.toLocaleDateString()+" "+s.toLocaleTimeString(),o=Object(m.jsxs)("span",{children:[Object(m.jsx)("span",{className:"chat_date",children:a}),Object(m.jsxs)("span",{className:"chat_send_txt",children:[t,Object(m.jsx)("br",{})]})]},i.length);i.push(o),this.setState({chat_text:i}),this.setState({input_text:""})}}},{key:"handlerKey",value:function(e){13!==e.keyCode&&14!==e.keyCode||this.onClickSend()}},{key:"log",value:function(e){var t=new Date;console.log("["+t.toLocaleTimeString()+"] "+e)}},{key:"log_error",value:function(e){var t=new Date;console.trace("["+t.toLocaleTimeString()+"] "+e)}},{key:"reportError",value:function(e){this.log_error("Error ".concat(e.name,": ").concat(e.message))}},{key:"sendToServer",value:function(e){var t=JSON.stringify(e);this.log("Sending '"+e.type+"' message: "+t),this.webSocket.send(t)}},{key:"ReconnectChat",value:function(e){"\u0414\u0430"==e&&(this.log("\u041f\u0435\u0440\u0435\u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 websocket \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f  .."),null!=this.webSocket&&this.webSocket.close(),this.connect())}},{key:"connect",value:function(){var e="ws",t=this.props.ws_server;console.log("Hostname: ",t),"https:"===document.location.protocol&&(e+="s"),this.serverUrl=e+t,console.log("Connecting to server: ",this.serverUrl),this.webSocket=new WebSocket(this.serverUrl),this.webSocket.onopen=this.onOpenConnection,this.webSocket.onmessage=this.onMessage}},{key:"onOpenConnection",value:function(){console.log("connection_open .."),this.msg_connect.user_name=this.myUsername,"yarikfanat"==this.msg_connect.user_name?this.msg_connect.func="trainer":this.msg_connect.func="client",this.isAlive=!0,this.webSocket.send(JSON.stringify(this.msg_connect)),this.checkAlive=setInterval(this.CheckConnection,15e3),this.setState({state_class:"state_indicator_on"})}},{key:"onMessage",value:function(e){var t=JSON.parse(e.data);switch(t.type){case"user_list":console.log("\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 ",t.list),this.CreateUserList(t.list);break;case"message":console.log("\u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 ",t.from_user,"=>",t.text);var n=this.state.chat_text.map((function(e){return e})),i=Object(m.jsxs)("span",{children:[Object(m.jsx)("span",{className:"chat_date",children:t.date}),Object(m.jsxs)("span",{className:"chat_from_user",children:[" ",t.from_user,"=> "]}),Object(m.jsxs)("span",{className:"chat_receive_txt",children:[t.text,Object(m.jsx)("br",{})]})]},n.length);n.push(i),this.setState({chat_text:n});break;case"video-offer":this.handleVideoOfferMsg(t);break;case"video-answer":this.handleVideoAnswerMsg(t);break;case"new-ice-candidate":this.handleNewICECandidateMsg(t);break;case"hang-up":this.handleHangUpMsg(t);break;case"ping_":this.sendToServer({type:"pong_"});break;case"ping":var s=new Date,a=s.toLocaleDateString()+" "+s.toLocaleTimeString();this.isAlive=!0,console.log(a," \u043f\u043e\u043b\u0443\u0447\u0435\u043d ping \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 <\u044f \u0436\u0438\u0432>")}}},{key:"CreateUserList",value:function(e){var t=this;this.target_user=null;var n=e.map((function(e,n){var i=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);return t.toString()}(e);return n||(t.target_user=e),Object(m.jsx)("li",{children:e},i)}));e.length>0?this.isControlsDisabled=!1:this.isControlsDisabled=!0,"videoChat"==this.typeChat?this.setState({target_user:this.target_user}):this.setState({user_list:n})}},{key:"CheckConnection",value:function(){var e=new Date,t=e.toLocaleDateString()+" "+e.toLocaleTimeString();1==this.isAlive?(console.log(t," checkAlive()=> \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0436\u0438\u0432\u043e\u0435 "),this.isAlive=!1,console.log("\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u044e pong \u0441\u0435\u0440\u0432\u0435\u0440\u0443"),this.sendToServer({type:"pong"})):(console.log(t," checkAlive()=> \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0443\u043c\u0435\u0440\u043b\u043e . \u041d\u0443\u0436\u0435\u043d reconnect"),this.msg_connect.user_name=null,this.setState({state_class:"state_indicator_off"}),clearInterval(this.checkAlive),this.log("ReConnecting to server: ".concat(this.serverUrl)),null!=this.webSocket&&this.webSocket.close(),this.connect())}},{key:"videoCall",value:function(){this.myPeerConnection?this.setState({videoMsg:"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0432\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043e\u043a \u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e?"}):this.invite()}},{key:"reInvite",value:function(e){"\u0414\u0430"==e&&(this.hangUpCall(),this.invite())}},{key:"closeVideoChat",value:function(e){"\u0414\u0430"==e&&(this.hangUpCall(),this.chatClose())}},{key:"invite",value:function(){var e=Object(v.a)(u.a.mark((function e(){var t=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.msg_connect.user_name){e.next=3;break}return this.setState({alertMsg:"\u0412\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043e\u043a \u043d\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d. \u0412\u044b \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u044b \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 \u0441\u0438\u0433\u043d\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438"}),e.abrupt("return");case 3:if(null!=this.target_user){e.next=6;break}return this.setState({alertMsg:"\u0412\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043e\u043a \u043d\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d. \u041d\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0430"}),e.abrupt("return");case 6:return this.log("\u0421\u0442\u0430\u0440\u0442\u0443\u044e \u0432\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043e\u043a"),this.log("Inviting user "+this.target_user),this.log("\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0441: "+this.target_user),this.createPeerConnection(),e.prev=10,e.next=13,navigator.mediaDevices.getUserMedia(this.mediaConstraints);case 13:this.webcamStream=e.sent,this.localVideo.srcObject=this.webcamStream,e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(10),this.handleGetUserMediaError(e.t0),e.abrupt("return");case 21:try{this.webcamStream.getTracks().forEach((function(e){return t.myPeerConnection.addTransceiver(e,{streams:[t.webcamStream]})}))}catch(n){this.handleGetUserMediaError(n)}case 22:case"end":return e.stop()}}),e,this,[[10,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"createPeerConnection",value:function(){var e=Object(v.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.log("\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f..."),this.myPeerConnection=new RTCPeerConnection({iceServers:[{urls:["stun:stun.stunprotocol.org","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun4.l.google.com:19302","stun:stun.ekiga.net","stun:stun.ideasip.com","stun:stun.rixtelecom.se","stun:stun.schlund.de"]},{urls:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"},{url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"},{url:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}]}),this.myPeerConnection.onicecandidate=this.handleICECandidateEvent,this.myPeerConnection.oniceconnectionstatechange=this.handleICEConnectionStateChangeEvent,this.myPeerConnection.onicegatheringstatechange=this.handleICEGatheringStateChangeEvent,this.myPeerConnection.onsignalingstatechange=this.handleSignalingStateChangeEvent,this.myPeerConnection.onnegotiationneeded=this.handleNegotiationNeededEvent,this.myPeerConnection.ontrack=this.handleTrackEvent;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleGetUserMediaError",value:function(e){switch(this.log_error(e),e.name){case"NotFoundError":this.setState({alertMsg:"\u041d\u0435 \u043c\u043e\u0433\u0443 \u043d\u0430\u0447\u0430\u0442\u044c \u0432\u0438\u0434\u0435\u043e\u0437\u0432\u043e\u043d\u043e\u043a, \u0442\u0430\u043a \u043a\u0430\u043a \u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u044b \u043a\u0430\u043c\u0435\u0440\u0430/\u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d"});break;case"SecurityError":case"PermissionDeniedError":break;default:var t="\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u0432\u0430\u0448\u0435\u0439 \u043a\u0430\u043c\u0435\u0440\u044b/\u043c\u0438\u043a\u0440\u043e\u0444\u043e\u043d\u0430: "+e.message;this.setState({alertMsg:t})}this.closeVideoCall()}},{key:"handleICECandidateEvent",value:function(e){e.candidate&&(this.log("*** \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 ICE \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432: "+e.candidate.candidate),this.sendToServer({type:"new-ice-candidate",target:this.target_user,candidate:e.candidate,from_user:this.myUsername}))}},{key:"handleTrackEvent",value:function(e){this.log("*** Track event"),this.receiveVideo.srcObject=e.streams[0]}},{key:"handleNegotiationNeededEvent",value:function(){var e=Object(v.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("*** Negotiation needed"),e.prev=1,this.log("---\x3e Creating offer"),e.next=5,this.myPeerConnection.createOffer();case 5:if(t=e.sent,"stable"==this.myPeerConnection.signalingState){e.next=9;break}return this.log("-- The connection isn't stable yet; postponing..."),e.abrupt("return");case 9:return this.log("---\x3e Setting local description to the offer"),e.next=12,this.myPeerConnection.setLocalDescription(t);case 12:this.log("---\x3e \u041e\u0442\u0441\u044b\u043b\u0430\u044e \u0432\u0438\u0434\u0435\u043e-\u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u043d\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u044b\u0439 \u0443\u0437\u0435\u043b"),this.sendToServer({from_user:this.myUsername,target:this.target_user,type:"video-offer",sdp:this.myPeerConnection.localDescription}),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),this.log("*** The following error occurred while handling the negotiationneeded event:"),this.reportError(e.t0);case 20:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleICEConnectionStateChangeEvent",value:function(e){switch(this.log("*** ICE connection state changed to "+this.myPeerConnection.iceConnectionState),this.myPeerConnection.iceConnectionState){case"closed":case"failed":case"disconnected":this.closeVideoCall()}}},{key:"handleSignalingStateChangeEvent",value:function(e){switch(this.log("*** WebRTC signaling state changed to: "+this.myPeerConnection.signalingState),this.myPeerConnection.signalingState){case"closed":this.closeVideoCall()}}},{key:"handleICEGatheringStateChangeEvent",value:function(e){(this.log("*** ICE gathering state changed to: "+this.myPeerConnection.iceGatheringState),"complete"==this.myPeerConnection.iceGatheringState)&&(1.3!=(this.videoWidth/this.videoHeight).toFixed(1)&&this.applyAspectRatio())}},{key:"closeVideoCall",value:function(){this.log("Closing the call"),this.myPeerConnection&&(this.log("--\x3e Closing the peer connection"),this.myPeerConnection.ontrack=null,this.myPeerConnection.onnicecandidate=null,this.myPeerConnection.oniceconnectionstatechange=null,this.myPeerConnection.onsignalingstatechange=null,this.myPeerConnection.onicegatheringstatechange=null,this.myPeerConnection.onnotificationneeded=null,this.myPeerConnection.getTransceivers().forEach((function(e){e.stop()})),this.localVideo.srcObject&&(this.localVideo.pause(),this.localVideo.srcObject.getTracks().forEach((function(e){e.stop()}))),this.myPeerConnection.close(),this.myPeerConnection=null,this.webcamStream=null)}},{key:"handleVideoOfferMsg",value:function(){var e=Object(v.a)(u.a.mark((function e(t){var n,i=this;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("Received video chat offer from "+t.from_user),this.myPeerConnection||this.createPeerConnection(),n=new RTCSessionDescription(t.sdp),"stable"==this.myPeerConnection.signalingState){e.next=10;break}return this.log("  - But the signaling state isn't stable, so triggering rollback"),e.next=7,Promise.all([this.myPeerConnection.setLocalDescription({type:"rollback"}),this.myPeerConnection.setRemoteDescription(n)]);case 7:return e.abrupt("return");case 10:return this.log("  - Setting remote description"),e.next=13,this.myPeerConnection.setRemoteDescription(n);case 13:if(this.webcamStream){e.next=26;break}return e.prev=14,e.next=17,navigator.mediaDevices.getUserMedia(this.mediaConstraints);case 17:this.webcamStream=e.sent,e.next=24;break;case 20:return e.prev=20,e.t0=e.catch(14),this.handleGetUserMediaError(e.t0),e.abrupt("return");case 24:this.localVideo.srcObject=this.webcamStream;try{this.webcamStream.getTracks().forEach((function(e){return i.myPeerConnection.addTransceiver(e,{streams:[i.webcamStream]})}))}catch(s){this.handleGetUserMediaError(s)}case 26:return this.log("---\x3e \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u0432\u0438\u0434\u0435\u043e-\u043e\u0442\u0432\u0435\u0442\u0430 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0449\u0435\u043c\u0443"),e.t1=this.myPeerConnection,e.next=30,this.myPeerConnection.createAnswer();case 30:return e.t2=e.sent,e.next=33,e.t1.setLocalDescription.call(e.t1,e.t2);case 33:this.sendToServer({from_user:this.myUsername,target:this.target_user,type:"video-answer",sdp:this.myPeerConnection.localDescription});case 34:case"end":return e.stop()}}),e,this,[[14,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleVideoAnswerMsg",value:function(){var e=Object(v.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("*** Call recipient has accepted our call"),n=new RTCSessionDescription(t.sdp),e.next=4,this.myPeerConnection.setRemoteDescription(n).catch(this.reportError);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleNewICECandidateMsg",value:function(){var e=Object(v.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RTCIceCandidate(t.candidate),this.log("*** \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u044e \u043f\u0440\u0438\u043d\u044f\u0442\u044b\u0445 ICE \u043a\u0430\u043d\u0434\u0438\u0434\u0430\u0442\u043e\u0432: "+JSON.stringify(n)),e.prev=2,e.next=5,this.myPeerConnection.addIceCandidate(n);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),this.reportError(e.t0);case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleHangUpMsg",value:function(e){var t=this.target_user+" \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u043b \u0432\u0438\u0434\u0435\u043e\u0441\u0432\u044f\u0437\u044c. \u0417\u0430\u043a\u0440\u044b\u0442\u044c \u0432\u0438\u0434\u0435\u043e\u0447\u0430\u0442?";this.log("*** \u041f\u0440\u0438\u043d\u044f\u0442\u043e hang up \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u043e\u0442 \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e\u0433\u043e \u0443\u0437\u043b\u0430"),this.closeVideoCall(),this.setState({closeMsg:t})}},{key:"hangUpCall",value:function(){var e={from_user:this.myUsername,target:this.target_user,type:"hang-up"};this.closeVideoCall(),this.sendToServer(e)}},{key:"applyAspectRatio",value:function(){var e=this,t=navigator.mediaDevices.getSupportedConstraints();if(console.log("supports contraints->",t),t.width){console.log("\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430  \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432 <Receive \u0432\u0438\u0434\u0435\u043e> :width=",this.videoWidth," height=",this.videoHeight);try{this.receiveVideo.srcObject.getVideoTracks().forEach((function(t){t.applyConstraints({width:{ideal:e.videoWidth},height:{ideal:e.videoHeight}}).then((function(){console.log("Sucessfull applyConstraints width=",e.videoWidth,"Height=",e.videoHeight)})).catch((function(e){console.log("The constraints could not be satisfied by the available devices")}))}))}catch(n){console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435 \u043d\u043e\u0432\u044b\u0445 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043a \u044d\u043a\u0440\u0430\u043d\u0430 Receive \u0432\u0438\u0434\u0435\u043e->",n.message)}}else console.log('getSupportedConstraints() :\u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 ["width"] \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f ')}},{key:"render",value:function(){var e,t,n,i,s=this,a=this.state.user_list,o=this.state.chat_text;if(i="textChat"==this.typeChat?"chat_container":"video_chat_container","show"==this.state.isChat&&(i+=" animate__animated animate__bounceInLeft"),"close"==this.state.isChat&&(i+=" animate__animated animate__rotateOut"),e="state_indicator_on"==this.state.state_class?"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0430\u043a\u0442\u0438\u0432\u043d\u043e":"\u0421\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043d\u0435 \u0430\u043a\u0442\u0438\u0432\u043d\u043e",t="state_indicator_on"==this.state.state_class?"\u0410\u043a\u0442\u0438\u0432\u043d\u043e":"\u041d\u0435 \u0430\u043a\u0442\u0438\u0432\u043d\u043e","textChat"==this.typeChat&&(n=Object(m.jsx)("div",{className:"modal_chat",children:Object(m.jsxs)("div",{className:i,onAnimationEnd:this.AnimationEnd,children:[Object(m.jsxs)("div",{className:"chat_upper_panel",children:[Object(m.jsx)("div",{className:"upper_panel_name",children:"\u0422\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0439 \u0447\u0430\u0442"}),Object(m.jsx)("div",{className:"upper_panel_close",onClick:this.chatClose,children:Object(m.jsx)("div",{className:"button_close",children:"X"})})]}),Object(m.jsxs)("div",{className:"chat_header_container",children:[Object(m.jsx)("div",{className:"chat_head",children:"\u0427\u0430\u0442"}),Object(m.jsx)("div",{className:"users_head",children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"})]}),Object(m.jsxs)("div",{className:"chat_box_container",children:[Object(m.jsx)("div",{className:"chat_head_",children:"\u0427\u0430\u0442"}),Object(m.jsx)(g,{children:o}),Object(m.jsx)("div",{className:"users_head_",children:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"}),Object(m.jsx)(b,{children:a})]}),Object(m.jsxs)("div",{className:"chat_controls_container",children:[Object(m.jsxs)("fieldset",{className:"state_network",children:[Object(m.jsx)("legend",{children:"\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441\u0435\u0442\u0438"}),Object(m.jsxs)("div",{className:"state_block",children:[Object(m.jsx)("div",{id:"st1",children:"\u0427\u0430\u0442:"}),Object(m.jsx)("div",{className:this.state.state_class}),Object(m.jsx)("div",{children:e})]}),Object(m.jsx)("div",{className:"state_control",children:Object(m.jsx)("input",{type:"button",name:"socketReconnect",value:"Reconnect chat",id:"reconnect",onClick:function(){s.setState({Msg:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0435 websocket \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e?"})}})})]}),Object(m.jsxs)("div",{className:"send_controls",children:[Object(m.jsx)("input",{type:"text",name:"text",size:"100",maxLength:"256",value:this.state.input_text,onChange:this.onChangeText,placeholder:"\u0417\u0434\u0435\u0441\u044c \u043d\u0430\u0431\u0438\u0440\u0430\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442 ...",id:"text_chat",autoComplete:"off",onKeyUp:this.handlerKey,disabled:this.isControlsDisabled}),Object(m.jsx)("input",{type:"button",name:"send",value:"Send",id:"send",onClick:this.onClickSend,disabled:this.isControlsDisabled})]})]})]})})),"videoChat"==this.typeChat){var c="video_dock_panel";this.state.isDockPanel&&" "!=this.state.isDockPanel&&("undock"==this.state.isDockPanel?c+=" animate__animated animate__backOutUp":c+=" animate__animated animate__bounceInDown");var r=Object(m.jsx)("div",{className:c,onAnimationEnd:this.AnimationEndDock,children:Object(m.jsxs)("fieldset",{className:"video_control_block",children:[Object(m.jsx)("legend",{children:"\u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0441\u0435\u0442\u0438"}),Object(m.jsxs)("div",{className:"button_network",onClick:function(){s.setState({Msg:"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0435 websocket \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0438 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0437\u0430\u043d\u043e\u0432\u043e?"})},children:[Object(m.jsx)("div",{className:this.state.state_class}),Object(m.jsx)("div",{id:"st3",children:e}),Object(m.jsx)("div",{id:"st2",children:t})]}),Object(m.jsx)("div",{className:"button_video_call",onClick:this.videoCall,children:Object(m.jsx)("img",{src:"img/video_call.png",className:"video_call"})}),Object(m.jsx)("div",{className:"button_hide_panel",onClick:this.undockVideoPanel,children:Object(m.jsx)("img",{src:"img/undock_panel.png",className:"video_undock_panel"})}),Object(m.jsxs)("div",{className:"user_name_container",children:[Object(m.jsx)("img",{src:"img/abonent-26.png"}),Object(m.jsx)("span",{children:this.state.target_user})]})]})});n=Object(m.jsx)("div",{className:"modal_chat",children:Object(m.jsxs)("div",{className:i,onAnimationEnd:this.AnimationEnd,children:[Object(m.jsxs)("div",{className:"video_chat_upper_panel",children:[Object(m.jsx)("div",{className:"video_upper_panel_name",children:"\u0412\u0438\u0434\u0435\u043e \u0447\u0430\u0442"}),Object(m.jsxs)("div",{className:"video_control_panel",children:[Object(m.jsx)("div",{className:"video_panel_close",onClick:this.dockVideoPanel,children:Object(m.jsx)("img",{src:"img/panel_video.png",className:"video_panel_dock"})}),Object(m.jsx)("div",{className:"video_close",onClick:this.chatClose,children:"X"})]})]}),Object(m.jsxs)("div",{className:"video_container",children:[Object(m.jsx)("video",{className:"receive_video",autoPlay:!0,ref:function(e){s.receiveVideo=e}}),Object(m.jsx)("video",{id:"local_video",autoPlay:!0,ref:function(e){s.localVideo=e}}),this.state.isDockPanel?r:null]})]})})}var l=Object(m.jsx)(N,{type:"confirm",effect:"backInLeft",render:function(e){s.setState({Msg:null}),s.ReconnectChat(e)},effectOut:"zoomOutRight",children:this.state.Msg}),h=Object(m.jsx)(N,{type:"confirm",effect:"backInLeft",render:function(e){s.setState({videoMsg:null}),s.reInvite(e)},effectOut:"zoomOutRight",children:this.state.videoMsg}),d=Object(m.jsx)(N,{type:"confirm",effect:"backInLeft",render:function(e){s.setState({closeMsg:null}),s.closeVideoChat(e)},effectOut:"zoomOutRight",children:this.state.closeMsg});return Object(m.jsxs)("div",{children:[this.state.isChat?n:null,this.state.Msg?l:null,this.state.videoMsg?h:null,this.state.closeMsg?d:null,this.state.alertMsg?Object(m.jsx)(N,{type:"alert",effect:"rubberBand",render:function(){s.setState({alertMsg:null})},effectOut:"rotateOut",children:this.state.alertMsg}):null]})}}]),n}(i.Component);n(441);function f(e){return Object(m.jsx)("div",{className:"passe-partout",onClick:function(t){e.ClickPhoto(e.indexLevel,t.clientX,t.clientY)},children:e.children})}function _(e){return Object(m.jsx)("div",{className:"block_main_ex",children:e.children})}function C(e){return Object(m.jsx)("div",{className:"equipment",children:e.children})}function y(e){return Object(m.jsx)("div",{className:"wrap_column",children:e.children})}function x(e){var t=e.indexLevel;return Object(m.jsx)("div",{className:"exercise_name",onClick:function(){e.ShowPhoto(t,e.complex_photos[0],e.complex_details[0],e.src_video[0])},children:e.children})}function O(e){var t=e.level,n=e.number,i=e.animation,s=e.last;return"hide"==i?Object(m.jsx)("li",{onAnimationEnd:s?function(){e.DeleteMoreExercises(t)}:null,className:"animation_lists_hide",children:e.children}):Object(m.jsx)("li",{className:"animation_lists_show",onClick:function(){e.ShowPhoto(t,e.complex_photos[n],e.complex_details[n],e.src_video[n])},children:e.children})}function k(e){var t=e.indexLevel,n=e.animation,i=e.exercises,s=0,a=i.length-1,o=i.map((function(i){var o=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);return t.toString()}(i);return Object(m.jsx)(O,{last:s==a,level:t,number:s++,animation:n,DeleteMoreExercises:e.DeleteMoreExercises,ShowPhoto:e.ShowPhoto,src_video:e.src_video,complex_photos:e.complex_photos,complex_details:e.complex_details,children:i},o)}));return o.splice(0,1),Object(m.jsx)("ul",{className:"list_exercise",children:o})}function S(e){var t,n=[],i=[],s=e.complex,a=e.photos,o=e.details,c=e.buttonShow,r=e.moreExercises,l=0;a.map((function(n,a){var h=Object(m.jsxs)(f,{ClickPhoto:e.ClickPhoto,indexLevel:a,children:[Object(m.jsx)("img",{src:n,className:"photo_equip"}),Object(m.jsxs)("div",{className:"info",children:[o[a].rounds,"x",o[a].reps]})]}),d=Object(m.jsxs)(_,{children:[Object(m.jsx)(w,{onButtonShowHadler:e.onButtonShowHadler,indexLevel:a,children:c[a]}),Object(m.jsx)(x,{ShowPhoto:e.ShowPhoto,src_video:s.src_video[a],complex_details:s.details[a],complex_photos:s.photo_equip[a],indexLevel:a,children:s.exercise_name[a][0]})]});t=null!=r[a]?Object(m.jsx)(k,{DeleteMoreExercises:e.DeleteMoreExercises,animation:r[a],indexLevel:a,src_video:s.src_video[a],exercises:s.exercise_name[a],ShowPhoto:e.ShowPhoto,complex_details:s.details[a],complex_photos:s.photo_equip[a]}):null,i.push(Object(m.jsxs)(C,{children:[h,d,t]},++l))}));var h=null,d=0;return i.map((function(e){++d,h||(h=e),2==d&&(n.push(Object(m.jsxs)(y,{children:[h,e]},++l)),h=null,d=0)})),h&&n.push(Object(m.jsx)(y,{children:h},++l)),Object(m.jsx)("div",{children:n})}var w=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).onChangeState=i.onChangeState.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"onChangeState",value:function(e){var t=this.props.indexLevel;this.props.onButtonShowHadler(t)}},{key:"render",value:function(){return Object(m.jsx)("div",{children:Object(m.jsx)("button",{className:"button_list_ex",onClick:this.onChangeState,children:Object(m.jsx)("b",{children:this.props.children})})})}}]),n}(i.Component),E=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={isMsg:null,isChatBox:!1},i.typeChat="",i.onClickPlay=i.onClickPlay.bind(Object(r.a)(i)),i.onChatBox=i.onChatBox.bind(Object(r.a)(i)),i.onVideoChatBox=i.onVideoChatBox.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"onChatBox",value:function(){this.typeChat="textChat",this.setState({isChatBox:!0})}},{key:"onVideoChatBox",value:function(){this.typeChat="videoChat",this.setState({isChatBox:!0})}},{key:"onClickPlay",value:function(){null==this.props.video?this.setState({isMsg:"\u0421\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0443\u043f\u0440\u0430\u0436\u043d\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u0432\u0438\u0434\u0435\u043e"}):""==this.props.video?this.setState({isMsg:"\u0412\u0438\u0434\u0435\u043e\u0440\u043e\u043b\u0438\u043a \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u043e\u043c"}):this.props.PlayVideo()}},{key:"render",value:function(){var e,t=this,n=this.props.player,i=this.props.user_name,s=this.props.ws_server;return e=n?"show"==n?"video_player animation_player_show":"video_player animation_player_hide":"video_player",Object(m.jsxs)("div",{className:"header_back",children:[""!=this.props.video?Object(m.jsx)("iframe",{src:this.props.video,className:e,title:"YouTube video player",allow:"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):null,Object(m.jsx)("div",{className:"header",children:Object(m.jsxs)("div",{className:"controls_container",children:[Object(m.jsx)("div",{className:"wrap_control",onClick:this.onChatBox,children:Object(m.jsx)("img",{className:"chatBox",src:"img/chat-box.png"})}),Object(m.jsx)("div",{className:"wrap_control",onClick:this.onClickPlay,children:Object(m.jsx)("img",{id:"youtube",src:"img/youtube.png"})}),Object(m.jsx)("div",{className:"wrap_control",onClick:this.onVideoChatBox,children:Object(m.jsx)("img",{className:"webCam",src:"img/webcam96_off.png"})})]})}),this.state.isMsg?Object(m.jsx)(N,{type:"alert",effect:"rubberBand",render:function(){t.setState({isMsg:null})},effectOut:"rotateOut",children:this.state.isMsg}):null,this.state.isChatBox?Object(m.jsx)(j,{typeChat:this.typeChat,user_name:i,ws_server:s,render:function(){t.setState({isChatBox:null})}}):null]})}}]),n}(i.Component),P=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={toolTip:null},i.out=!1,i.tool_class="",i.clickHandler=i.clickHandler.bind(Object(r.a)(i)),i.AnimationEnd=i.AnimationEnd.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"AnimationEnd",value:function(){this.out&&this.props.render()}},{key:"componentDidMount",value:function(){this.tool_class="weight animate__animated animate__"+this.props.effect,this.setState({toolTip:!0})}},{key:"clickHandler",value:function(){this.tool_class="weight animate__animated animate__"+this.props.effectOut,this.out=!0,this.setState({toolTip:!0})}},{key:"render",value:function(){return Object(m.jsx)("div",{children:this.state.toolTip?Object(m.jsx)("div",{className:this.tool_class,style:{left:this.props.posX,top:this.props.posY},onClick:this.clickHandler,onAnimationEnd:this.AnimationEnd,children:Object(m.jsx)("div",{className:"weight_text",children:this.props.children})}):null})}}]),n}(i.Component),M=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={photos:[],buttonShow:[],moreExercises:[],details:[],video:null,player:null,chat:null,headBarVisible:!0,toolTip:!1},i.arrayVideo=[],i.posX=0,i.posY=0,i.onButtonShowHadler=i.onButtonShowHadler.bind(Object(r.a)(i)),i.onChatHandler=i.onChatHandler.bind(Object(r.a)(i)),i.DeleteMoreExercises=i.DeleteMoreExercises.bind(Object(r.a)(i)),i.ShowPhoto=i.ShowPhoto.bind(Object(r.a)(i)),i.PlayVideo=i.PlayVideo.bind(Object(r.a)(i)),i.ClickPhoto=i.ClickPhoto.bind(Object(r.a)(i)),i.setVisibleHeadBar=i.setVisibleHeadBar.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"setVisibleHeadBar",value:function(e){this.setState({headBarVisible:e})}},{key:"onChatHandler",value:function(){var e=this.state.chat;e=null==e||"hide"==e?"show":"hide",this.setState({chat:e})}},{key:"ClickPhoto",value:function(e,t,n){var i,s=this.arrayVideo[e];this.posX=t-100,this.posY=n-75,i=""!=s,this.setState({video:s,toolTip:i})}},{key:"PlayVideo",value:function(){this.state.video;var e=this.state.player;e=null==e||"hide"==e?"show":"hide",this.setState({player:e})}},{key:"ShowPhoto",value:function(e,t,n,i){var s=this.state.photos,a=this.state.details;s[e]=t,a[e]=n,this.arrayVideo[e]=i,this.setState({photos:s,details:a,video:i})}},{key:"DeleteMoreExercises",value:function(e){var t=this.state.moreExercises,n=this.state.photos,i=this.state.details,s=this.props.complex;t[e]=null,n[e]=s.photo_equip[e][0],i[e]=s.details[e][0],this.setState({photos:n,moreExercises:t,details:i})}},{key:"onButtonShowHadler",value:function(e){var t=this.state.buttonShow,n=this.state.moreExercises;"-"==t[e]?(t[e]="+",n[e]="hide"):(t[e]="-",n[e]="show"),this.setState({buttonShow:t,moreExercises:n})}},{key:"componentDidMount",value:function(){var e=this,t=[],n=[],i=[],s=this.props.complex,a=s.photo_equip.map((function(a,o){return t.push("+"),n.push(null),i.push(s.details[o][0]),e.arrayVideo.push(s.src_video[o][0]),a[0]}));this.setState({photos:a,buttonShow:t,moreExercises:n,details:i})}},{key:"render",value:function(){var e=this,t=this.props.complex,n=this.props.user_name,i=this.state.photos,s=this.state.video,a=this.state.buttonShow,o=this.state.moreExercises,c=this.state.details,r=this.state.player;return Object(m.jsxs)("div",{children:[this.state.headBarVisible?Object(m.jsx)(E,{user_name:n,video:s,player:r,PlayVideo:this.PlayVideo,ws_server:this.props.ws_server}):null,Object(m.jsxs)("div",{className:"full_wrap",children:[Object(m.jsx)(S,{DeleteMoreExercises:this.DeleteMoreExercises,onButtonShowHadler:this.onButtonShowHadler,moreExercises:o,buttonShow:a,photos:i,complex:t,ShowPhoto:this.ShowPhoto,details:c,ClickPhoto:this.ClickPhoto}),Object(m.jsx)("div",{className:"empty"})]}),this.state.toolTip?Object(m.jsx)(P,{posX:this.posX,posY:this.posY,effect:"rotateIn",effectOut:"rotateOut",render:function(){e.setState({toolTip:!1})},children:"\u0414\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u0440\u043e\u043b\u0438\u043a\u0430 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043a\u0438\u043d\u043e\u043a\u0430\u043c\u0435\u0440\u0443"}):null]})}}]),n}(i.Component),N=(n(442),n(443),n(444),function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={showBox:!1,boxPos:{}},i.class_box="msg_box",i.isCloseState=null,i.isDownMouse=!1,i.delta={},i.AnimationEnd=i.AnimationEnd.bind(Object(r.a)(i)),i.ClickButton=i.ClickButton.bind(Object(r.a)(i)),i.handleMouseDown=i.handleMouseDown.bind(Object(r.a)(i)),i.handleMouseUp=i.handleMouseUp.bind(Object(r.a)(i)),i.handleMouseMove=i.handleMouseMove.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"AnimationEnd",value:function(){this.class_box="msg_box",this.isCloseState&&this.props.render(this.isCloseState)}},{key:"componentDidMount",value:function(){"undefined"!=typeof this.props.effect&&(this.class_box+=" animate__animated animate__"+this.props.effect),this.setState({showBox:!0})}},{key:"componentDidUpdate",value:function(e){var t=this;this.isCloseState&&(p.isIE||p.isEdge)&&setTimeout((function(){t.props.render(t.isCloseState)}),1500)}},{key:"ClickButton",value:function(e){"undefined"!=typeof this.props.effectOut?(this.isCloseState=e.target.textContent,this.class_box+=" animate__animated animate__"+this.props.effectOut,this.setState({showBox:!0})):this.props.render(e.target.textContent)}},{key:"handleMouseDown",value:function(e){var t=this.msgBox.getBoundingClientRect();this.delta={left:e.clientX-t.left,top:e.clientY-t.top},this.isDownMouse=!0}},{key:"handleMouseUp",value:function(){this.isDownMouse=!1}},{key:"handleMouseMove",value:function(e){if(this.isDownMouse){var t=e.clientX-this.delta.left,n=e.clientY-this.delta.top;this.class_box="msg_box1",this.setState({boxPos:{left:t,top:n}})}}},{key:"render",value:function(){var e,t,n=this;return e="confirm"==this.props.type?Object(m.jsxs)("div",{className:"container_buttons",children:[Object(m.jsx)("button",{className:"button_yes",onClick:this.ClickButton,children:"\u0414\u0430"}),Object(m.jsx)("button",{className:"button_no",onClick:this.ClickButton,children:"\u041d\u0435\u0442"})]}):Object(m.jsx)("div",{className:"container_button",children:Object(m.jsx)("button",{onClick:this.ClickButton,children:"Ok"})}),t=Object(m.jsxs)("div",{className:this.class_box,style:this.state.boxPos,onAnimationEnd:this.AnimationEnd,ref:function(e){n.msgBox=e},children:[Object(m.jsx)("div",{className:"upper_panel",onMouseDown:this.handleMouseDown,children:"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435"}),Object(m.jsx)("div",{className:"container_text",children:this.props.children}),e]}),Object(m.jsx)("div",{className:"modal",onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,children:this.state.showBox?t:null})}}]),n}(i.Component)),D=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={arrayClips:[]},i.arrayImage=[{front_video:"clips/1.mp4",back_video:"clips/6.mp4"},{front_video:"clips/2.mp4",back_video:"clips/7.mp4"},{front_video:"clips/3.mp4",back_video:"clips/8.mp4"},{front_video:"clips/4.mp4",back_video:"clips/9.mp4"},{front_video:"clips/5.mp4",back_video:"clips/10.mp4"},{front_video:"clips/1.mp4",back_video:"clips/6.mp4"}],i.animation={reverseIn:"animate__flipInY",reverseOut:"animate__flipOutY",delayIn:"animate__delay-0s",delayOut:"animate__delay-0s"},i.createClip=!1,i.front_video_reverse=null,i.back_video_reverse=null,i.indexReverse=0,i.arrayVideo=[],i.lastVideo=null,i.interval=null,i.shiftClips=i.shiftClips.bind(Object(r.a)(i)),i.createArrayClips=i.createArrayClips.bind(Object(r.a)(i)),i.ReverseClip=i.ReverseClip.bind(Object(r.a)(i)),i.PlayVideo=i.PlayVideo.bind(Object(r.a)(i)),i.PlayVideo_=i.PlayVideo_.bind(Object(r.a)(i)),i.reInitClips=i.reInitClips.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"shiftClips",value:function(){var e=this;this.arrayImage.shift(),this.arrayImage[this.arrayImage.length]=this.arrayImage[0],this.arrayVideo.forEach((function(t,n){for(var i="animation_clip"+(n+1),s=t.classList,a=0;a<s.length;a++)-1!=s[a].indexOf("animation_clip")&&t.classList.remove(s[a]);t.classList.remove(e.animation.reverseIn),t.classList.remove(e.animation.delayIn),t.classList.add(i)})),this.lastVideo=this.arrayVideo.shift(),this.arrayVideo[this.arrayVideo.length]=this.lastVideo,(p.isIE||p.isEdge)&&p.isDesktop&&(this.interval=setTimeout((function(){e.reInitClips()}),3e3))}},{key:"reInitClips",value:function(){var e=this.arrayImage.length-1;this.arrayVideo[e].src=this.arrayImage[0].front_video,this.arrayVideo.forEach((function(e,t){for(var n=e.classList,i=0;i<n.length;i++)-1!=n[i].indexOf("clip")&&n[i].startsWith("clip")&&e.classList.remove(n[i]);e.classList.add("clip"+(t+1));for(i=0;i<n.length;i++)-1!=n[i].indexOf("animation_clip")&&e.classList.remove(n[i])})),(p.isIE||p.isEdge)&&p.isDesktop&&this.PlayVideo_(this.indexReverse)}},{key:"PlayVideo_",value:function(e){var t=this;this.interval=setTimeout((function(){t.ReverseClip(e,t.animation.reverseOut,t.animation.delayOut)}),1e4)}},{key:"PlayVideo",value:function(e){var t=this;this.arrayVideo[e].play().then((function(){new Promise((function(e){t.interval=setTimeout((function(){e()}),1e4)})).then((function(){new Promise((function(n){t.arrayVideo[e].onanimationend=function(){n()},t.ReverseClip(e,t.animation.reverseOut,t.animation.delayOut)})).then((function(){new Promise((function(n){t.arrayVideo[e].onanimationend=function(){n()},t.arrayImage[e].front_video=t.back_video_reverse,t.arrayImage[e].back_video=t.front_video_reverse,t.arrayVideo[e].src=t.arrayImage[e].front_video,t.ReverseClip(e,t.animation.reverseIn,t.animation.delayIn)})).then((function(){t.arrayVideo[e].play().then((function(){new Promise((function(e){t.interval=setTimeout((function(){e()}),1e4)})).then((function(){new Promise((function(n){t.arrayVideo[e].onanimationend=function(){n()};var i=t.arrayImage.length-1;t.arrayVideo[i].src=t.arrayImage[0].front_video,t.shiftClips()})).then((function(){t.reInitClips(),t.PlayVideo(e)}))}))}))}))}))}))}))}},{key:"createArrayClips",value:function(){var e=this,t=!1,n=!1;(p.isIE||p.isEdge)&&p.isDesktop&&(t=!0,n=!0);var i=this.arrayImage.map((function(i,s){var a="video_img clip"+(s+1)+" animate__animated";return Object(m.jsx)("video",{className:a,autoPlay:t,loop:n,muted:!0,src:i.front_video,ref:function(t){e.video=t,e.arrayVideo[s]=e.video}},s)}));this.createClip=!0,this.setState({arrayClips:i})}},{key:"ReverseClip",value:function(e,t,n){var i=this;if(this.indexReverse=e,this.front_video_reverse=this.arrayImage[e].front_video,this.back_video_reverse=this.arrayImage[e].back_video,this.arrayVideo[e].classList.remove(this.animation.reverseIn),this.arrayVideo[e].classList.remove(this.animation.reverseOut),this.arrayVideo[e].classList.remove(this.animation.delayOut),this.arrayVideo[e].classList.remove(this.animation.delayIn),this.arrayVideo[e].classList.add(t),this.arrayVideo[e].classList.add(n),(p.isIE||p.isEdge)&&p.isDesktop)if(-1!=t.indexOf("Out"))this.arrayImage[this.indexReverse].front_video=this.back_video_reverse,this.arrayImage[this.indexReverse].back_video=this.front_video_reverse,this.interval=setTimeout((function(){i.arrayVideo[i.indexReverse].src=i.arrayImage[i.indexReverse].front_video}),500),this.interval=setTimeout((function(){i.ReverseClip(e,i.animation.reverseIn,i.animation.delayIn)}),1e3);else{var s=this.arrayImage.length-1;this.arrayVideo[s].src=this.arrayImage[0].front_video,this.interval=setTimeout((function(){i.shiftClips()}),1e4)}}},{key:"componentDidMount",value:function(){(!p.isIE&&!p.isEdge||p.isDesktop)&&this.createArrayClips()}},{key:"componentWillUnmount",value:function(){p.isIE||p.isEdge||this.arrayVideo.forEach((function(e,t){e.onanimationend=null})),clearTimeout(this.interval)}},{key:"componentDidUpdate",value:function(e){this.createClip&&(this.createClip=!1,p.isIE||p.isEdge?p.isDesktop&&this.PlayVideo_(0):this.PlayVideo(0))}},{key:"render",value:function(){return Object(m.jsx)("div",{className:"video_block",children:this.state.arrayClips})}}]),n}(i.Component);function V(e){for(var t,n=[],i=0;i<=34;i++)n.push(Object(m.jsx)("div",{className:"lenta_win"},i));for(i=0;i<=18;i++)n.push(Object(m.jsx)("div",{className:"lenta_win_"},i));return t="up"==e.pos?"lenta":"lenta2",Object(m.jsxs)("div",{className:t,children:[n,[]]})}function I(e){return Object(m.jsx)("div",{className:e.class_name,id:e.text_id,children:e.children})}function L(){return Object(m.jsxs)("div",{className:"name_head",children:[Object(m.jsx)(I,{class_name:"name_head1 animate__animated animate__bounceInLeft animate__delay-1s animate__slow",text_id:"head_name1",children:"\u0422\u0440\u0435\u043d\u0435\u0440"}),Object(m.jsx)(I,{class_name:"name_head2 animate__animated animate__bounceInRight animate__delay-1s animate__slow",text_id:"head_name2",children:"\u043e\u043d\u043b\u0430\u0439\u043d"})]})}function T(e){return Object(m.jsxs)("div",{className:e.class_name,id:e.form_id,children:[Object(m.jsx)("div",{className:"my_logo",children:"Copyright \u0411\u043e\u0439\u0447\u0443\u043a \u042f\u0440\u043e\u0441\u043b\u0430\u0432"}),Object(m.jsx)(U,{onLogon:e.onLogon,onSaveData:e.onSaveData,isSaveData:e.isSaveData})]})}var U=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={login:"",password:""},i.onChangeLogin=i.onChangeLogin.bind(Object(r.a)(i)),i.onChangePassword=i.onChangePassword.bind(Object(r.a)(i)),i.onClickHandler=i.onClickHandler.bind(Object(r.a)(i)),i.handlerKey=i.handlerKey.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"onChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"onChangeLogin",value:function(e){this.setState({login:e.target.value})}},{key:"onClickHandler",value:function(e){this.props.onLogon({user_name:this.state.login,password:this.state.password})}},{key:"handlerKey",value:function(e){13!==e.keyCode&&14!==e.keyCode||this.onClickHandler()}},{key:"render",value:function(){return Object(m.jsxs)("div",{className:"input_block",children:[Object(m.jsx)("p",{children:Object(m.jsx)("b",{children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f:"})}),Object(m.jsx)("input",{type:"text",id:"usr",value:this.state.login,onChange:this.onChangeLogin}),Object(m.jsx)("p",{children:Object(m.jsx)("b",{children:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c:"})}),Object(m.jsx)("input",{type:"password",id:"pass",value:this.state.password,onChange:this.onChangePassword,onKeyUp:this.handlerKey}),Object(m.jsx)("input",{type:"button",id:"btn",value:"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c",onClick:this.onClickHandler}),Object(m.jsxs)("p",{children:[Object(m.jsx)("input",{type:"checkbox",checked:this.props.isSaveData,id:"chk",onChange:this.props.onSaveData}),Object(m.jsx)("span",{children:Object(m.jsx)("b",{children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435"})})]})]})}}]),n}(i.Component);function A(e){return Object(m.jsxs)("div",{className:"back",children:[Object(m.jsxs)("div",{className:"logon_container animate__animated animate__backInLeft",children:[Object(m.jsx)(L,{}),Object(m.jsx)(T,{form_id:"frm0",class_name:"frame",onLogon:e.onLogon,onSaveData:e.onSaveData,isSaveData:e.isSaveData})]}),Object(m.jsx)(V,{pos:"up"}),Object(m.jsx)(D,{}),Object(m.jsx)(V,{pos:"down"})]})}var R=function(e){Object(l.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={showLogon:!1,isSaveData:!0,isMsg:!1},i.user_exist=!1,i.users=null,i.agentInfo="",i.onLogon=i.onLogon.bind(Object(r.a)(i)),i.onStateLogon=i.onStateLogon.bind(Object(r.a)(i)),i.onSaveData=i.onSaveData.bind(Object(r.a)(i)),i.checkCookie=i.checkCookie.bind(Object(r.a)(i)),i.CheckUser=i.CheckUser.bind(Object(r.a)(i)),i.setCookie=i.setCookie.bind(Object(r.a)(i)),i.getCookie=i.getCookie.bind(Object(r.a)(i)),i.getConfig=i.getConfig.bind(Object(r.a)(i)),i}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.checkCookie();e?this.CheckUser(e):this.onStateLogon(!0)}},{key:"CheckUser",value:function(e){var t=this;fetch("json/users.json").then((function(e){return e.json()})).then((function(n){t.users=n;var i=t.users.usr_name.findIndex((function(t){return t==e.user_name}));if(-1!=i&&t.users.usr_pass[i]==e.password){0==t.user_exist&&t.state.isSaveData&&(t.setCookie("username",e.user_name,365),t.setCookie("password",e.password,365)),t.onStateLogon(!1);var s=t.users.usr_conf[i];null!=s&&""!=s&&t.getConfig(s,e.user_name,t.users.ws_server)}else 1==t.user_exist?(document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="password=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",t.user_exist=!1,t.onStateLogon(!0)):t.setState({isMsg:!0})}))}},{key:"getConfig",value:function(e,t,n){var i,s=this,o=new XMLHttpRequest;o.onreadystatechange=function(){4==o.readyState&&200==o.status&&(i=JSON.parse(o.responseText),s.props.render("none"),a.a.render(Object(m.jsx)(M,{complex:i,user_name:t,ws_server:n}),document.getElementById("wrap")))},o.open("GET",e,!0),o.send()}},{key:"checkCookie",value:function(){var e={user_name:"",password:""};return e.password=this.getCookie("password"),e.user_name=this.getCookie("username"),this.user_exist=!1,""!=e.user_name&&(""!=e.password&&(this.user_exist=!0,e))}},{key:"setCookie",value:function(e,t,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var s="expires="+i.toGMTString();document.cookie=e+"="+t+";"+s+";path=/"}},{key:"getCookie",value:function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),i=0;i<n.length;i++){for(var s=n[i];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}},{key:"onStateLogon",value:function(e){this.setState({showLogon:e})}},{key:"onLogon",value:function(e){this.CheckUser(e)}},{key:"onSaveData",value:function(e){this.setState((function(e){return{isSaveData:!e.isSaveData}}))}},{key:"render",value:function(){var e=this;return this.state.showLogon?Object(m.jsxs)("div",{style:{width:"100%",height:"100%"},children:[Object(m.jsx)(A,{onLogon:this.onLogon,onSaveData:this.onSaveData,isSaveData:this.state.isSaveData}),this.state.isMsg?Object(m.jsx)(N,{type:"alert",effect:"zoomInDown",render:function(){e.setState({isMsg:!1})},effectOut:"zoomOutDown",children:"\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0432\u0435\u0440\u043d\u044b"}):null]}):null}}]),n}(i.Component);a.a.render(Object(m.jsx)(R,{render:function(e){document.getElementById("logon").style.display=e}}),document.getElementById("logon"))}},[[445,1,2]]]);
//# sourceMappingURL=main.57f7891a.chunk.js.map
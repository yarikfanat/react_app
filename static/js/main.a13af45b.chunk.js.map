{"version":3,"sources":["chat.js","trainer.js","start.js","index.js"],"names":["UserListBox","props","className","children","ChatBox","scrollWindow","bind","prevProps","this","maxScrollTop","chatWindow","scrollHeight","clientHeight","scrollTop","ref","div","Component","ChatContainer","state","input_text","chat_text","user_list","state_class","Msg","isChat","isDockPanel","target_user","alertMsg","videoMsg","closeMsg","localVideo","width","height","serverUrl","webSocket","isAlive","isControlsDisabled","msg_connect","type","user_name","func","myUsername","countUpdate","typeChat","webcamStream","mediaConstraints","audio","video","aspectRatio","ideal","mediaConstraintsReceive","myPeerConnection","receiveVideo","videoWidth","videoHeight","setLocalCamera","checkNetwork","onChangeText","onClickSend","handlerKey","AnimationEnd","AnimationEndDock","chatClose","undockVideoPanel","dockVideoPanel","log","log_error","reportError","connect","ReconnectChat","onOpenConnection","onMessage","sendToServer","CheckConnection","CreateUserList","invite","createPeerConnection","handleGetUserMediaError","handleICECandidateEvent","handleICEConnectionStateChangeEvent","handleICEGatheringStateChangeEvent","handleSignalingStateChangeEvent","handleNegotiationNeededEvent","handleVideoOfferMsg","handleVideoAnswerMsg","handleTrackEvent","closeVideoCall","handleHangUpMsg","hangUpCall","videoCall","reInvite","closeVideoChat","onResize","applyAspectRatio","onFullScreen","setCamera","checkNet","element","window","document","docEl","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen","call","event","clientWidth","console","outerWidth","outerHeight","setTimeout","render","setState","localHeight","isIE","isEdge","Math","round","addEventListener","removeEventListener","close","clearInterval","checkAlive","target","value","msg","text","from_user","map","txt_block","d","Date","date","toLocaleDateString","toLocaleTimeString","length","push","keyCode","time","trace","errMessage","name","message","msgJSON","JSON","stringify","send","scheme","myHostname","ws_server","location","protocol","WebSocket","onopen","onmessage","clearTimeout","setInterval","parse","data","list","receive_text","handleNewICECandidateMsg","items","user","index","key","str","i","charCodeAt","toString","getKey","a","navigator","mediaDevices","getUserMedia","srcObject","getTracks","forEach","track","addTransceiver","streams","err","RTCPeerConnection","iceServers","urls","credential","username","url","onicecandidate","oniceconnectionstatechange","onicegatheringstatechange","onsignalingstatechange","onnegotiationneeded","ontrack","e","candidate","createOffer","offer","signalingState","setLocalDescription","sdp","localDescription","iceConnectionState","iceGatheringState","onnicecandidate","onnotificationneeded","getTransceivers","transceiver","stop","pause","desc","RTCSessionDescription","Promise","all","setRemoteDescription","createAnswer","catch","RTCIceCandidate","addIceCandidate","isSendMsg","supports","getSupportedConstraints","trackVideo","getVideoTracks","applyConstraints","then","error","state_msg","state_msg2","chatbox","chat_class","onAnimationEnd","onClick","id","size","maxLength","onChange","placeholder","autoComplete","onKeyUp","disabled","dock_panel_class","localStyle","dock_panel","src","autoPlay","style","muted","msgBox","effect","effectOut","Passport","ClickPhoto","indexLevel","clientX","clientY","BlockExercise","Equipments","WrapColumn","MainExercise","level","ShowPhoto","complex_photos","complex_details","src_video","AddExercise","number","animation","last_element","last","DeleteMoreExercises","AlternativeExercises","exercises","exercise","splice","CreateTrainComponents","Exercises","rows","columns","complex","photos","details","buttonShow","moreExercises","photo","passport","rounds","reps","block","onButtonShowHadler","photo_equip","exercise_name","prev","count","column","ButtonShow","onChangeState","HeadBar","isMsg","isChatBox","onClickPlay","onChatBox","onVideoChatBox","doc","documentElement","requestFullScreen","cancelFullScreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","PlayVideo","player_class","controlScreen","player","isAndroid","isMobile","title","allow","allowFullScreen","ToolTip","toolTip","out","tool_class","clickHandler","left","posX","top","posY","TrainExercise","chat","headBarVisible","arrayVideo","onChatHandler","tooltip","detail","MessageBox","showBox","boxPos","class_box","isCloseState","isDownMouse","delta","ClickButton","handleMouseDown","handleMouseUp","handleMouseMove","textContent","rect","getBoundingClientRect","buttons","box","onMouseDown","onMouseMove","onMouseUp","ClipsAnimation","arrayClips","arrayImage","front_video","back_video","reverseIn","reverseOut","delayIn","delayOut","createClip","front_video_reverse","back_video_reverse","indexReverse","lastVideo","interval","shiftClips","createArrayClips","ReverseClip","PlayVideo_","reInitClips","shift","class_clip","classList","indexOf","remove","add","isDesktop","last_index","startsWith","play","myResolve","onanimationend","autoplay","loop","img","delay","Lenta","class_lenta","array_win","pos","AnimationText","class_name","text_id","AnimationHead","FormEntry","form_id","onLogon","onSaveData","isSaveData","InputsBlock","login","password","onChangeLogin","onChangePassword","onClickHandler","checked","Logon","class_logon","Start","showLogon","user_exist","users","agentInfo","onStateLogon","checkCookie","CheckUser","setCookie","getCookie","getConfig","account","fetch","result","json","usr_name","findIndex","usr_pass","conf_json","usr_conf","cookie","config","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","responseText","ReactDOM","getElementById","open","cname","cvalue","exdays","setTime","getTime","expires","toGMTString","ca","decodeURIComponent","split","c","charAt","substring","prevState","display"],"mappings":"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","file":"static/js/main.a13af45b.chunk.js","sourcesContent":["import React, {Component} from 'react'\r\nimport {MessageBox} from './start'\r\nimport {\r\n  isIE,\r\n  isEdge\r\n} from \"react-device-detect\";\r\n/*import adapter from 'webrtc-adapter';*/\r\nimport './css/chat.css'\r\n\r\nfunction UserListBox(props) {\r\n\treturn <ul className=\"userslistbox\">{props.children}</ul>;\r\n}\r\n\r\nclass ChatBox extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.scrollWindow = this.scrollWindow.bind(this);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tthis.scrollWindow();\r\n\t}\r\n\r\n\tscrollWindow() {\r\n\r\n\t\tconst scrollHeight = this.chatWindow.scrollHeight;\r\n\t\tconst height = this.chatWindow.clientHeight;\r\n\t\tconst maxScrollTop = scrollHeight - height;\r\n\t\tthis.chatWindow.scrollTop = maxScrollTop > 0 ? maxScrollTop : 0;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn <div className=\"chat_window\" ref={(div) => {\r\n\t\t\tthis.chatWindow = div;\r\n\t\t}} >{this.props.children}</div>;\r\n\t}\r\n\t\r\n}\r\n\r\nclass ChatContainer extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {input_text:'',chat_text:[],user_list:null,state_class:'state_indicator_off',\r\n\t\t\t\t\t  Msg:null,isChat:null,isDockPanel:' ',target_user:null,alertMsg:null,\r\n\t\t\t\t\t  videoMsg:null,closeMsg:null,localVideo:{width:0,height:0}\r\n\t\t\t\t\t };\r\n\t\t\r\n\t\tthis.serverUrl = '';\r\n\t\tthis.webSocket = null;\r\n\t\tthis.isAlive = false;\r\n\t\tthis.isControlsDisabled = true;\r\n\t\tthis.target_user = null;\r\n\t\tthis.msg_connect = {type:'connect_user',user_name:null,func:null};\r\n\t\tthis.myUsername = this.props.user_name;\r\n\t\tthis.countUpdate = 0;\r\n\t\tthis.typeChat = '';\r\n\r\n\t\tthis.webcamStream = null;\r\n\t\tthis.mediaConstraints = { audio: true,video: { aspectRatio: { ideal: 1.33 } }};\r\n\t\tthis.mediaConstraintsReceive = { audio: true,video: { width:0,height:0, aspectRatio: { ideal: 1.33 } }};\t\t\r\n\t\tthis.myPeerConnection = null;\r\n\t\tthis.receiveVideo = null;\r\n\t\tthis.localVideo = null;\r\n\t\tthis.videoWidth = 0;\r\n\t\tthis.videoHeight = 0;\r\n\t\tthis.setLocalCamera = false;\r\n\t\tthis.checkNetwork = null;\r\n\t\r\n\t\tthis.onChangeText = this.onChangeText.bind(this);\r\n\t\tthis.onClickSend = this.onClickSend.bind(this);\r\n\t\tthis.handlerKey = this.handlerKey.bind(this);\r\n\t\r\n\t\tthis.AnimationEnd =  this.AnimationEnd.bind(this);\r\n\t\tthis.AnimationEndDock =  this.AnimationEndDock.bind(this);\r\n\t\tthis.chatClose =  this.chatClose.bind(this);\r\n\t\tthis.undockVideoPanel =  this.undockVideoPanel.bind(this);\r\n\t\tthis.dockVideoPanel =  this.dockVideoPanel.bind(this);\r\n\r\n\t\tthis.log = this.log.bind(this);\r\n\t\tthis.log_error = this.log_error.bind(this);\r\n\t\tthis.reportError = this.reportError.bind(this);\r\n\t\tthis.connect = this.connect.bind(this);\r\n\t\tthis.ReconnectChat = this.ReconnectChat.bind(this);\r\n\t\tthis.onOpenConnection = this.onOpenConnection.bind(this);\r\n\t\tthis.onMessage = this.onMessage.bind(this);\r\n\t\tthis.sendToServer = this.sendToServer.bind(this);\r\n\t\tthis.CheckConnection = this.CheckConnection.bind(this);\r\n\t\tthis.CreateUserList = this.CreateUserList.bind(this);\r\n\r\n\t\tthis.invite = this.invite.bind(this);\r\n\t\tthis.createPeerConnection = this.createPeerConnection.bind(this);\r\n\t\tthis.handleGetUserMediaError = this.handleGetUserMediaError.bind(this);\r\n\t\tthis.handleICECandidateEvent = this.handleICECandidateEvent.bind(this);\r\n\t\tthis.handleICEConnectionStateChangeEvent = this.handleICEConnectionStateChangeEvent.bind(this);\r\n\t\tthis.handleICEGatheringStateChangeEvent = this.handleICEGatheringStateChangeEvent.bind(this);\r\n\t\tthis.handleSignalingStateChangeEvent = this.handleSignalingStateChangeEvent.bind(this);\r\n\t\tthis.handleNegotiationNeededEvent = this.handleNegotiationNeededEvent.bind(this);\r\n\t\tthis.handleVideoOfferMsg = this.handleVideoOfferMsg.bind(this);\r\n\t\tthis.handleVideoAnswerMsg = this.handleVideoAnswerMsg.bind(this);\r\n\t\tthis.handleTrackEvent = this.handleTrackEvent.bind(this);\r\n\t\tthis.closeVideoCall = this.closeVideoCall.bind(this);\r\n\t\tthis.handleHangUpMsg = this.handleHangUpMsg.bind(this);\r\n\t\tthis.hangUpCall = this.hangUpCall.bind(this);\r\n\t\tthis.videoCall = this.videoCall.bind(this);\r\n\t\tthis.reInvite = this.reInvite.bind(this);\r\n\t\tthis.closeVideoChat = this.closeVideoChat.bind(this);\r\n\t\tthis.onResize = this.onResize.bind(this);\r\n\t\tthis.applyAspectRatio = this.applyAspectRatio.bind(this);\r\n\t\tthis.onFullScreen = this.onFullScreen.bind(this);\r\n\t\tthis.setCamera = this.setCamera.bind(this);\r\n\t\tthis.checkNet = this.checkNet.bind(this);\r\n\t}\r\n\r\n\tonFullScreen (element) {\r\n\t\tvar doc = window.document;\r\n    \tvar docEl = element;\r\n    \tvar requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;\r\n    \t\r\n\t\trequestFullScreen.call(docEl);\r\n\t\t\r\n\t}\r\n\r\n\tonResize(event) {\r\n\t\t \r\n\t\tthis.videoHeight = this.receiveVideo.clientHeight;\r\n\t\tthis.videoWidth = this.receiveVideo.clientWidth;\t\r\n\t\tconsole.log('new width=',this.videoWidth,'new height=',this.videoHeight,'windowWidth=',window.outerWidth,'WindowHeight=',window.outerHeight);\r\n\t\tif (this.webcamStream) {\t\t\t\r\n\t\t\tthis.applyAspectRatio();\r\n\t\t}\r\n\t}\r\n\r\n\tAnimationEnd() {\r\n\r\n\t\tif (!this.msg_connect.user_name && this.state.isChat=='show' && this.state.isDockPanel==' ') {\r\n\t\t\tthis.checkNetwork = setTimeout (this.checkNet,10000);\r\n\t\t//\tthis.setState ({Msg:'Нет связи с WebSocket сервером сигнализации или он выключен. Повторить попытку?'});\r\n\t\t\t\r\n\t\t}\r\n\t\tif (this.state.isChat=='close') {\r\n\r\n\t\t\tthis.props.render();\r\n\t\t}\r\n\t}\r\n\r\n\tcheckNet() {\r\n\t\tthis.checkNetwork = null;\r\n\t\tif (!this.msg_connect.user_name)\r\n\t\t\tthis.setState ({Msg:'Нет связи с WebSocket сервером сигнализации или он выключен. Повторить попытку?'});\r\n\t}\r\n\r\n\tAnimationEndDock() {\r\n\t\tif (this.state.isDockPanel=='undock')\r\n\t\t\tthis.setState({isDockPanel:null});\r\n\t\tif (this.state.isDockPanel=='dock')\r\n\t\t\tthis.setState({isDockPanel:' '});\r\n\t\tif (this.state.isChat=='close') {\r\n\r\n\t\t\tthis.props.render();\r\n\t\t}\r\n\t}\r\n\r\n\tdockVideoPanel() {\r\n\t\tif (this.state.isDockPanel != ' ')\r\n\t\t\tthis.setState({isDockPanel:'dock'});\r\n\t}\r\n\r\n\tundockVideoPanel() {\r\n\t\t\r\n\t\tthis.setState({isDockPanel:'undock'});\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\r\n\t\tif (this.state.isChat=='show' && (isIE || isEdge) && !this.msg_connect.user_name && this.countUpdate<2) {\r\n\t\t\tif (++this.countUpdate==2) {\t\r\n\r\n\t\t//\t\tthis.setState ({Msg:'Нет связи с WebSocket сервером сигнализации или он выключен. Повторить попытку?'});\r\n\t\t\t\tthis.checkNetwork = setTimeout (this.checkNet,10000);\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\tif (this.state.isChat=='close' && (isIE || isEdge)) {\r\n\t\t\tsetTimeout (()=>{this.props.render();},1500);\r\n\t\t}\r\n\t\tif (this.typeChat == 'videoChat' && !this.videoHeight && !this.videoWidth) {\r\n\t\t\tthis.videoHeight = this.receiveVideo.clientHeight;\r\n\t\t\tthis.videoWidth = this.receiveVideo.clientWidth;\r\n\r\n\t\t\tvar localWidth,localHeight;\r\n\t\t\r\n\t\t\tlocalWidth = 120;\r\n\t\t\tlocalHeight = Math.round (localWidth/this.mediaConstraints.video.aspectRatio.ideal);\r\n\t\t\tconsole.log('start width=',this.videoWidth,'start height=',this.videoHeight);\r\n\t\t\tthis.setState ({localVideo:{width:localWidth,height:localHeight}});\t\t\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t \r\n\t\tthis.typeChat = this.props.typeChat;\t\r\n\t\tif (this.typeChat == 'videoChat') {\r\n\t\t\twindow.addEventListener(\"resize\", this.onResize);\r\n\t\t\tconsole.log ('windowWidth=',window.outerWidth,'WindowHeight=',window.outerHeight);\r\n\t\t\tthis.mediaConstraintsReceive.video.width = window.outerWidth;\r\n\t\t\tthis.mediaConstraintsReceive.video.height = window.outerHeight;\r\n\t\t\tif (window.outerWidth < window.outerHeight)\r\n\t\t\t\tthis.mediaConstraints.video.aspectRatio.ideal = window.outerHeight/window.outerWidth;\r\n\t\t\telse\r\n\t\t\t\tthis.mediaConstraints.video.aspectRatio.ideal = window.outerWidth/window.outerHeight;\r\n\t\t\tthis.mediaConstraintsReceive.video.aspectRatio.ideal = this.mediaConstraints.video.aspectRatio.ideal;\r\n\t\t\t\r\n\t\t}\r\n\t\tthis.setState ({isChat:'show'});\r\n\t\tif (!this.webSocket)\r\n\t\t{\r\n\t\t\tthis.connect ();\r\n\t\t}\t\t\t\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.typeChat=='videoChat') {\r\n\t\t\twindow.removeEventListener(\"resize\", this.onResize);\r\n\t\t}   \r\n\t}\r\n\r\n\tchatClose() {\r\n\t\tif (this.typeChat=='videoChat' && this.myPeerConnection) {\r\n\t\t\tthis.setState ({closeMsg:'Закрыть видеочат и завершить видеосвязь?'});\r\n\t\t} else {\r\n\r\n\t\t\tif (this.webSocket !=null)\r\n\t\t    \tthis.webSocket.close ();\t\r\n\t\t    clearInterval(this.checkAlive);\r\n\t\t    this.webcamStream = null;\r\n\t\t\tthis.setState ({isChat:'close'});\t\t\t\r\n\t\t}\t\t\r\n\t}\r\n\r\n\tonChangeText(event) {\r\n\t\t this.setState({input_text: event.target.value});\r\n\t}\r\n\r\n\tonClickSend(event) {\r\n\t\t var input_text = this.state.input_text;\r\n\t\t var msg = {\r\n\t\t \ttype: \"message_touser\",\r\n\t\t    text: input_text,\r\n\t\t    target:this.target_user,\r\n\t\t    from_user:this.props.user_name\r\n\t\t };\r\n\r\n\t\t if (input_text=='')\r\n\t\t \treturn;\r\n\r\n\t\t this.sendToServer(msg);\r\n\t\t var chat_text = this.state.chat_text.map(txt_block=> {\r\n\t\t \treturn txt_block;\r\n\t\t });\r\n\r\n\t\t var d = new Date();\r\n\t\t var date = d.toLocaleDateString()+' '+d.toLocaleTimeString();\r\n\r\n\t\t var txt_block = <span key={chat_text.length}><span className='chat_date'>{date}</span>\r\n\t\t \t\t\t\t\t  <span className='chat_send_txt'>{input_text}<br/></span>\r\n\t\t \t\t\t\t </span>;\r\n\t\t chat_text.push (txt_block);\r\n         this.setState({chat_text: chat_text});\r\n\t\t this.setState({input_text: ''});\r\n\t}\r\n\r\n\thandlerKey(event) {\r\n\t\tif (event.keyCode === 13 || event.keyCode === 14) {\r\n\t\t  this.onClickSend();\r\n\t\t}\r\n\t}\r\n\r\n\tlog(text) {\r\n\t\tvar time = new Date();\r\n\r\n\t\tconsole.log(\"[\" + time.toLocaleTimeString() + \"] \" + text);\r\n\t}\r\n\r\n\tlog_error(text) {\r\n\t\tvar time = new Date();\r\n\r\n\t\tconsole.trace(\"[\" + time.toLocaleTimeString() + \"] \" + text);\r\n\t}\r\n\r\n\treportError(errMessage) {\r\n\t\tthis.log_error(`Error ${errMessage.name}: ${errMessage.message}`);\r\n\t}\r\n\r\n\tsendToServer(msg) {\r\n\t\tvar msgJSON = JSON.stringify(msg);\r\n\r\n\t\tthis.log(\"Sending '\" + msg.type + \"' message: \" + msgJSON);\r\n\t\tthis.webSocket.send(msgJSON);\r\n\t}\r\n\r\n\tReconnectChat(state) {\r\n\t\tif (state=='Да')\r\n\t    {\r\n\t    \tthis.log (\"Переустановка websocket соединения  ..\");\r\n\t    \tif (this.webSocket !=null)\r\n\t    \t\tthis.webSocket.close ();\r\n\t\t\tthis.connect ();\r\n\t    }\t    \r\n\t}\r\n\r\n\tconnect() {\r\n\r\n\t\tvar scheme = \"ws\";\r\n\t\tvar myHostname = this.props.ws_server;\r\n//\t\tvar myHostname = window.location.hostname;\r\n/*\t\tif (!myHostname) {\r\n\t  \t\tmyHostname = \"localhost\";\r\n\t\t}*/\r\n\t\tconsole.log(\"Hostname: \", myHostname);\r\n\r\n\t\tif (document.location.protocol === \"https:\") {\r\n\t\t  \tscheme += \"s\";\r\n\t\t}\r\n\t//\tthis.serverUrl = scheme + \"://\" + myHostname + \":8080\";\r\n\t\tthis.serverUrl = scheme + myHostname;\r\n\t\tconsole.log('Connecting to server: ',this.serverUrl);\r\n\t\tthis.webSocket = new WebSocket(this.serverUrl);\r\n\r\n\t\tthis.webSocket.onopen = this.onOpenConnection;\r\n\t\tthis.webSocket.onmessage = this.onMessage;\r\n\r\n\t}\r\n\r\n\tonOpenConnection() {\r\n\t\tconsole.log ('connection_open ..');\r\n\t\tif (this.checkNetwork) {\r\n\t\t\tclearTimeout (this.checkNetwork);\r\n\t\t\tthis.checkNetwork = null;\r\n\t\t}\r\n\t\tthis.msg_connect.user_name = this.myUsername;\r\n\t\tif (this.msg_connect.user_name=='yarikfanat')\r\n\t\t\tthis.msg_connect.func = 'trainer';\r\n\t\telse\r\n\t\t\tthis.msg_connect.func = 'client';\r\n\t\tthis.isAlive = true;\r\n\r\n\t\tthis.webSocket.send(JSON.stringify(this.msg_connect));\t\r\n\t\tthis.checkAlive = setInterval (this.CheckConnection,15000);\r\n\t\tthis.setState({state_class: 'state_indicator_on'});\r\n\t}\r\n\r\n\tonMessage(event) {\r\n\t\tvar msg = JSON.parse(event.data);\t\t\t\r\n\r\n\t\tswitch(msg.type) {\r\n\t\t\tcase \"user_list\":\r\n\t\t\t\tconsole.log ('получено сообщение ',msg.list);\r\n\t\t      \tthis.CreateUserList (msg.list);\r\n\t\t      \tbreak;\r\n\t\t\t   \r\n\t\t    case \"message\":\r\n\t\t    \tconsole.log ('получено сообщение от ',msg.from_user,'=>',msg.text);\r\n\r\n\t\t    \tvar space = ' ';\r\n\t\t    \tvar chat_text = this.state.chat_text.map(txt_block=> {\r\n\t\t    \t\treturn txt_block;\r\n\t\t    \t});\r\n\r\n\t\t\t\tvar receive_text = <span key={chat_text.length}><span className='chat_date'>{msg.date}</span><span className='chat_from_user'>{space}{msg.from_user}{'=> '}</span>\r\n\t\t\t\t\t\t\t\t   <span className='chat_receive_txt'>{msg.text}<br/></span></span>;\r\n\t\t\t\tchat_text.push (receive_text);\r\n\t\t\t\tthis.setState({chat_text: chat_text});\r\n\t\t\t    break;\r\n\r\n\t\t    case \"video-offer\":  \r\n\t\t    \tthis.handleVideoOfferMsg(msg);\r\n\t\t    \tbreak;\r\n\r\n\t\t    case \"video-answer\":  \r\n\t\t    \tthis.handleVideoAnswerMsg(msg);\r\n\t          \tbreak;\r\n\t\t    case \"new-ice-candidate\": \r\n\t\t    \tthis.handleNewICECandidateMsg(msg);\r\n\t\t      \tbreak;\r\n\r\n\t\t    case \"hang-up\": \r\n\t\t    \tthis.handleHangUpMsg(msg);\r\n\t\t      \tbreak;\r\n\t\t     \r\n\t\t    case \"ping_\":\r\n\t\t    \tthis.sendToServer ({type:'pong_'});  \t         \r\n\t\t      \tbreak;\r\n\t\t\tcase \"ping\":\r\n\t\t\t  \tvar d = new Date();\r\n\t          \tvar date = d.toLocaleDateString()+' '+d.toLocaleTimeString();\r\n\t\t\t  \tthis.isAlive=true;\r\n\t\t\t  \tconsole.log (date,' получен ping от сервера <я жив>');\r\n\t\t\t  \tbreak;\t\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tCreateUserList(user_list) {\r\n\t\tfunction getKey(str){\r\n\t      let key = 0;\r\n\t      for (let i = 0; i < str.length; i++) {\r\n\t        key += str.charCodeAt(i);\r\n\t      }\r\n\t      return key.toString();\r\n\t    }\r\n\t    this.target_user = null;\r\n\t\tconst items = user_list.map((user,index) => {\r\n      \t\tconst key = getKey(user);\r\n      \t\tif (!index)\r\n      \t\t\tthis.target_user = user;\r\n      \t\treturn <li key={key}>{user}</li>;\r\n    \t});\r\n    \tuser_list.length>0? this.isControlsDisabled = false:this.isControlsDisabled = true;\r\n    \tif (this.typeChat=='videoChat')\r\n    \t\tthis.setState ({target_user:this.target_user});\r\n    \telse\r\n    \t\tthis.setState ({user_list:items});\r\n\r\n\t}\r\n\r\n\tCheckConnection() {\r\n\t\tvar d = new Date();\r\n\t\tvar date = d.toLocaleDateString()+' '+d.toLocaleTimeString();\r\n\t\t\t\r\n\t\tif (this.isAlive==true)\r\n\t\t{\r\n\t\t\tconsole.log (date,' checkAlive()=> соединение живое ');\r\n\t\t\tthis.isAlive=false;\r\n\r\n\t\t\tconsole.log ('Отправляю pong серверу');\r\n\t\t    this.sendToServer ({type:'pong'});\r\n\t\t}else\r\n\t\t{\r\n\t\t\tconsole.log (date,' checkAlive()=> соединение умерло . Нужен reconnect');\t\r\n\t\t\tthis.msg_connect.user_name = null;\t\r\n\t\t\tthis.setState({state_class: 'state_indicator_off'})\t\t\t\r\n\t\t\tclearInterval(this.checkAlive);\r\n\t\t\tthis.log(`ReConnecting to server: ${this.serverUrl}`);\r\n\t\t\tif (this.webSocket !=null)\r\n\t\t\t\tthis.webSocket.close ();\r\n\t\t\tthis.connect ();\r\n\t\t}\r\n\t}\r\n\r\n\tvideoCall() {\r\n\t\tif (this.myPeerConnection) {\r\n\t\t\tthis.setState ({videoMsg:'Завершить текущий видеозвонок и перезапустить заново?'});\r\n\t\t} else\r\n\t\t\tthis.invite();\r\n\t}\r\n\r\n\treInvite(state) {\r\n\t\tif (state=='Да') {\r\n\r\n\t\t\tthis.hangUpCall(false);\r\n\t\t\tthis.invite();\r\n\t\t}\r\n\t}\r\n\r\n\tcloseVideoChat(state) {\r\n\t\tif (state=='Да') {\r\n\r\n\t\t\tthis.hangUpCall(true);\r\n\t\t\tthis.chatClose();\r\n\t\t}\r\n\t}\r\n\r\n\tasync setCamera () {\r\n\t\ttry {\r\n\r\n\t\t\tif (!this.webcamStream) {\r\n\r\n\t\t\t\t this.webcamStream = await navigator.mediaDevices.getUserMedia(this.mediaConstraints);\r\n\t\t\t\t this.localVideo.srcObject = this.webcamStream;\r\n\t\t\t\t this.setLocalCamera = true;\r\n\t\t\t}\t\t   \r\n\t\t    this.onFullScreen(this.localVideo);\r\n\t\t} catch(err) {\r\n\r\n\t\t  this.handleGetUserMediaError(err);\r\n\t\t  return;\r\n\t\t}\r\n\t}\r\n\r\n\tasync invite() {\r\n\t\tif (this.msg_connect.user_name == null) {\r\n\t\t\tthis.setState ({alertMsg:'Видеозвонок не возможен. Вы не подключены к серверу сигнализации'});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.target_user == null) {\r\n\t\t\tif (this.msg_connect.func == 'client')\r\n\t\t\t\tthis.setState ({alertMsg:'Видеозвонок не возможен. Тренер не подкючен к сети'});\r\n\t\t\telse\r\n\t\t\t\tthis.setState ({alertMsg:'Видеозвонок не возможен. Нет подключенного собеседника'});\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.log(\"Стартую видеозвонок\");\r\n\t\t \r\n\t\tthis.log(\"Inviting user \" + this.target_user);\r\n\t\tthis.log(\"Установка соединения с: \" + this.target_user);\r\n\t\tthis.createPeerConnection();\r\n\r\n\t\ttry {\r\n\r\n\t\t    this.webcamStream = await navigator.mediaDevices.getUserMedia(this.mediaConstraints);\r\n\t\t    this.localVideo.srcObject = this.webcamStream;\r\n\t\t} catch(err) {\r\n\r\n\t\t  this.handleGetUserMediaError(err);\r\n\t\t  return;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tthis.webcamStream.getTracks().forEach(\r\n\t\t\t\ttrack => this.myPeerConnection.addTransceiver(track, {streams: [this.webcamStream]})\r\n\t\t    );\r\n\t\t} catch(err) {\r\n\r\n\t\t  this.handleGetUserMediaError(err);\r\n\t\t}\r\n\t}\r\n\r\n\tasync createPeerConnection() {\r\n\t\tthis.log(\"Настройка соединения...\");\r\n\r\n\t\tthis.myPeerConnection = new RTCPeerConnection({\r\n\t\t\ticeServers: [     \r\n\t\t\t\t\t      \t{ \turls: [\"stun:stun.stunprotocol.org\",\"stun:stun1.l.google.com:19302\",\"stun:stun2.l.google.com:19302\",\r\n\t\t\t\t\t\t\t\t\t   \"stun:stun4.l.google.com:19302\",\"stun:stun.ekiga.net\",\"stun:stun.ideasip.com\",\"stun:stun.rixtelecom.se\",\r\n\t\t\t\t\t\t\t\t\t   \"stun:stun.schlund.de\"] \r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t    {\r\n\t\t\t\t\t\t      \turls: \"turn:192.158.29.39:3478?transport=udp\", \r\n\t\t\t\t\t\t      \tcredential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=', \r\n\t\t\t\t\t     \t\tusername: '28224511:1379330808' \r\n\t\t\t\t\t\t    },\r\n\t\t\t\t\t\t    {\r\n\t\t\t\t\t\t    \turls: 'turn:numb.viagenie.ca',\r\n\t\t    \t\t\t\t\tcredential: 'muazkh',\r\n\t\t    \t\t\t\t\tusername: 'webrtc@live.com'\r\n\t\t\t\t\t\t    },\r\n\t\t\t\t\t\t    {\r\n\t\t\t\t\t\t\t    url: 'turn:turn.bistri.com:80',\r\n\t\t\t\t\t\t\t    credential: 'homeo',\r\n\t\t\t\t\t\t\t    username: 'homeo'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t    url: 'turn:turn.anyfirewall.com:443?transport=tcp',\r\n\t\t\t\t\t\t\t    credential: 'webrtc',\r\n\t\t\t\t\t\t\t    username: 'webrtc'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]\r\n\t\t\t\t\t});\r\n\t\tthis.myPeerConnection.onicecandidate = this.handleICECandidateEvent;\r\n\t\tthis.myPeerConnection.oniceconnectionstatechange = this.handleICEConnectionStateChangeEvent;\r\n\t\tthis.myPeerConnection.onicegatheringstatechange = this.handleICEGatheringStateChangeEvent;\r\n\t\tthis.myPeerConnection.onsignalingstatechange = this.handleSignalingStateChangeEvent;\r\n\t\tthis.myPeerConnection.onnegotiationneeded = this.handleNegotiationNeededEvent;\r\n\t\tthis.myPeerConnection.ontrack = this.handleTrackEvent;\r\n\t}\r\n\r\n\r\n\thandleGetUserMediaError(e) {\r\n\t\tthis.log_error(e);\r\n\r\n\t\tswitch(e.name) {\r\n\t\t    case \"NotFoundError\":\r\n\r\n\t\t    \tthis.setState ({alertMsg:'Не могу начать видеозвонок, так как не обнаружены камера/микрофон'});\r\n\t\t      \tbreak;\r\n\t\t    case \"SecurityError\":\r\n\t\t    case \"PermissionDeniedError\":\r\n\r\n\t\t      \tbreak;\r\n\t\t    default:\r\n\r\n\t\t    \tvar msg = \"Ошибка открытия вашей камеры/микрофона: \" + e.message;\r\n\t\t    \tthis.setState ({alertMsg:msg});\r\n\t\t      \tbreak;\r\n\t\t}\r\n\r\n\t  \tthis.closeVideoCall();\r\n\t}\r\n\r\n\thandleICECandidateEvent(event) {\r\n\r\n\t\tif (event.candidate) {\r\n\t\t\tthis.log(\"*** Отправка ICE кандидатов: \" + event.candidate.candidate);\r\n\r\n\t\t\tthis.sendToServer({\r\n\t\t\t\ttype: \"new-ice-candidate\",\r\n\t\t\t\ttarget: this.target_user,\r\n\t\t\t\tcandidate: event.candidate,\r\n\t\t\t\tfrom_user: this.myUsername\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\thandleTrackEvent(event) {\r\n\r\n\t\tthis.log(\"*** Track event\");\r\n\t\tthis.receiveVideo.srcObject = event.streams[0];\r\n\r\n\t\t\r\n\t}\r\n\r\n\tasync handleNegotiationNeededEvent() {\r\n\r\n\t\tthis.log(\"*** Negotiation needed\");\r\n\r\n\t\ttry {\r\n\r\n\t\t\tthis.log(\"---> Creating offer\");\r\n\t\t\tconst offer = await this.myPeerConnection.createOffer();\r\n\r\n\t\t\tif (this.myPeerConnection.signalingState != \"stable\") {\r\n\r\n\t\t\t\tthis.log(\"-- The connection isn't stable yet; postponing...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.log(\"---> Setting local description to the offer\");\r\n\t\t\tawait this.myPeerConnection.setLocalDescription(offer);\r\n\r\n\t\t\tthis.log(\"---> Отсылаю видео-предложение на удаленный узел\");\r\n\r\n\t\t\tthis.sendToServer({\r\n\t\t\t\tfrom_user: this.myUsername,\r\n\t\t\t\ttarget: this.target_user,\r\n\t\t\t\ttype: \"video-offer\",\r\n\t\t\t\tsdp: this.myPeerConnection.localDescription\r\n\t\t\t});\r\n\t\t} catch(err) {\r\n\r\n\t\t\tthis.log(\"*** The following error occurred while handling the negotiationneeded event:\");\r\n\t\t\tthis.reportError(err);\r\n\t\t}\r\n\t}\r\n\r\n\thandleICEConnectionStateChangeEvent(event) {\r\n\r\n\t\tthis.log(\"*** ICE connection state changed to \" + this.myPeerConnection.iceConnectionState);\r\n\r\n\t\tswitch(this.myPeerConnection.iceConnectionState) {\r\n\t\t\tcase \"closed\":\r\n\t\t\tcase \"failed\":\r\n\t\t\tcase \"disconnected\":\r\n\r\n\t\t\t\tthis.closeVideoCall();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\thandleSignalingStateChangeEvent(event) {\r\n\r\n\t\tthis.log(\"*** WebRTC signaling state changed to: \" + this.myPeerConnection.signalingState);\r\n\r\n\t\tswitch(this.myPeerConnection.signalingState) {\r\n\r\n\t\t\tcase \"closed\":\r\n\r\n\t\t\t\tthis.closeVideoCall();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\thandleICEGatheringStateChangeEvent(event) {\r\n\r\n\t\tthis.log(\"*** ICE gathering state changed to: \" + this.myPeerConnection.iceGatheringState);\t\t\r\n\t}\r\n\r\n\tcloseVideoCall() {\r\n\r\n\t\tthis.log(\"Closing the call\");\r\n\r\n\t\tif (this.myPeerConnection) {\r\n\r\n\t\t\tthis.log(\"--> Closing the peer connection\");\r\n\t\t\tthis.myPeerConnection.ontrack = null;\r\n\t\t\tthis.myPeerConnection.onnicecandidate = null;\r\n\t\t\tthis.myPeerConnection.oniceconnectionstatechange = null;\r\n\t\t\tthis.myPeerConnection.onsignalingstatechange = null;\r\n\t\t\tthis.myPeerConnection.onicegatheringstatechange = null;\r\n\t\t\tthis.myPeerConnection.onnotificationneeded = null;\r\n\r\n\t\t\tthis.myPeerConnection.getTransceivers().forEach(transceiver => {\r\n\t\t\t\ttransceiver.stop();\r\n\t\t\t});\r\n\r\n\t\t\tif (this.localVideo.srcObject) {\r\n\r\n\t\t\t\tthis.localVideo.pause();\r\n\t\t\t\tthis.localVideo.srcObject.getTracks().forEach(track => {\r\n\t\t\t\t\ttrack.stop();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tthis.myPeerConnection.close();\r\n\t\t\tthis.myPeerConnection = null;\r\n\t\t\tthis.webcamStream = null;\r\n\t\t}\r\n\t}\r\n\r\n\tasync handleVideoOfferMsg(msg) {\r\n\r\n\t\tthis.log(\"Received video chat offer from \" + msg.from_user);\r\n\t\tif (!this.myPeerConnection) {\r\n\r\n\t\t\tthis.createPeerConnection();\r\n\t\t}\r\n\r\n\t\tvar desc = new RTCSessionDescription(msg.sdp);\r\n\r\n\t\tif (this.myPeerConnection.signalingState != \"stable\") {\r\n\r\n\t\t\tthis.log(\"  - But the signaling state isn't stable, so triggering rollback\");\r\n\t\t\tawait Promise.all([\r\n\r\n\t\t\t\tthis.myPeerConnection.setLocalDescription({type: \"rollback\"}),\r\n\t\t\t\tthis.myPeerConnection.setRemoteDescription(desc)\r\n\t\t\t\t]);\r\n\r\n\t\t\treturn;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.log (\"  - Setting remote description\");\r\n\t\t\tawait this.myPeerConnection.setRemoteDescription(desc);\r\n\t\t}\r\n\r\n\t\tif (!this.webcamStream || this.setLocalCamera) {\r\n\t\t\tthis.setLocalCamera = null;\r\n\t\t\ttry {\r\n\r\n\t\t\t\tthis.webcamStream = await navigator.mediaDevices.getUserMedia(this.mediaConstraints);\r\n\t\t\t} catch(err) {\r\n\r\n\t\t\t\tthis.handleGetUserMediaError(err);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.localVideo.srcObject = this.webcamStream;\r\n\t\t\ttry {\r\n\r\n\t\t\t\tthis.webcamStream.getTracks().forEach(\r\n\t\t\t\t\ttrack => this.myPeerConnection.addTransceiver(track, {streams: [this.webcamStream]})\r\n\t\t\t\t\t);\r\n\r\n\t\t\t} catch(err) {\r\n\r\n\t\t\t\tthis.handleGetUserMediaError(err);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.log(\"---> Отправка видео-ответа вызывающему\");\r\n\t\tawait this.myPeerConnection.setLocalDescription(await this.myPeerConnection.createAnswer());\r\n\r\n\t\tthis.sendToServer({\r\n\t\t\tfrom_user: this.myUsername,\r\n\t\t\ttarget: this.target_user,\r\n\t\t\ttype: \"video-answer\",\r\n\t\t\tsdp: this.myPeerConnection.localDescription\r\n\t\t});\r\n\t}\r\n\r\n\tasync handleVideoAnswerMsg(msg) {\r\n\r\n\t\tthis.log(\"*** Call recipient has accepted our call\");\r\n\r\n\t\tvar desc = new RTCSessionDescription(msg.sdp);\r\n\t\tawait this.myPeerConnection.setRemoteDescription(desc).catch(this.reportError);\r\n\t}\r\n\r\n\tasync handleNewICECandidateMsg(msg) {\r\n\t\tvar candidate = new RTCIceCandidate(msg.candidate);\r\n\r\n\t\tthis.log(\"*** Добавляю принятых ICE кандидатов: \" + JSON.stringify(candidate));\r\n\t\ttry {\r\n\r\n\t\t\tawait this.myPeerConnection.addIceCandidate(candidate)\r\n\t\t} catch(err) {\r\n\t\t\tthis.reportError(err);\r\n\t\t}\r\n\t} \r\n\r\n\thandleHangUpMsg(msg) {\r\n\t\tvar closeMsg = this.target_user+' завершил видеосвязь. Закрыть видеочат?';\r\n\r\n\t\tthis.log(\"*** Принято hang up сообщение от удаленного узла\");\r\n\t\tthis.closeVideoCall();\r\n\t\tthis.setState ({closeMsg:closeMsg});\r\n\t}\r\n\r\n\thangUpCall(isSendMsg) {\r\n\t\tvar msg={\r\n\t\t\tfrom_user: this.myUsername,\r\n\t\t\ttarget: this.target_user,\r\n\t\t\ttype: \"hang-up\"\r\n\t\t};\r\n\r\n\t\tthis.closeVideoCall();\r\n\t\tif (isSendMsg)\r\n\t\t\tthis.sendToServer(msg);\r\n\t}\r\n\r\n\tapplyAspectRatio () {\r\n\t\tvar supports = navigator.mediaDevices.getSupportedConstraints();\r\n\t\t\r\n\t\tconsole.log ('supports contraints->',supports);\r\n\t\tif (!supports[\"width\"]) {\r\n\r\n\t\t\tconsole.log ('getSupportedConstraints() :ограничение [\"width\"] не поддерживается ');\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\t\r\n\t\tconsole.log ('Установка  параметров <Receive видео> :width=',this.videoWidth,' height=',this.videoHeight);\r\n\t\ttry {\r\n\t\t\t\tconst trackVideo = this.receiveVideo.srcObject.getVideoTracks()[0];\r\n\t\t\t//\tconst aspectRatio = this.videoWidth/this.videoHeight;\r\n\t\t\t//\ttrackVideo.applyConstraints( {video: {width:{ideal:this.videoWidth},height:{ideal:this.videoHeight}}})\r\n\t\t\t//\ttrackVideo.applyConstraints( {video: {width:this.videoWidth,height:this.videoHeight,aspectRatio: aspectRatio.toFixed(2)}})\r\n\t\t\t\tthis.mediaConstraintsReceive.video.width = window.outerWidth;\r\n\t\t\t\tthis.mediaConstraintsReceive.video.height = window.outerHeight;\r\n\r\n\t\t\t\ttrackVideo.applyConstraints(this.mediaConstraintsReceive)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t    console.log ('applyConstraints aspectRatio receive video(trackVideo) Sucessfull -->','width=',this.videoWidth,'height=',this.videoHeight);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t    console.log ('applyConstraints receive video(trackVideo) error->',e);\r\n\t\t\t\t});\r\n\r\n\t\t} catch (err) {\r\n\r\n\t\t\tconsole.error('Ошибка при установке новых настроек экрана Receive видео->', err.message);\r\n\t\t}/*\r\n\t\ttry {\r\n\t\t\t\tconst trackVideo = this.localVideo.srcObject.getVideoTracks()[0];\r\n\t\t\t\tconst aspectRatio = this.state.localVideo.width/this.state.localVideo.height;\r\n\t\t\t\r\n\t\t\t\ttrackVideo.applyConstraints( {video: {width:this.state.localVideo.width,height:this.state.localVideo.height,aspectRatio: aspectRatio.toFixed(2)}})\r\n\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t    console.log ('applyConstraints aspectRatio local video(trackVideo) Sucessfull -->','width=',this.state.localVideo.width,'height=',this.state.localVideo.height);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(e => {\r\n\t\t\t\t    console.log ('applyConstraints local video(trackVideo) error->',e);\r\n\t\t\t\t});\r\n\r\n\t\t} catch (err) {\r\n\r\n\t\t\tconsole.error('Ошибка при установке новых настроек экрана Local видео->', err.message);\r\n\t\t}*/\r\n\t}\r\n\r\n\trender() {\r\n\t\tvar state_msg,state_msg2;\r\n\t\tvar chatbox;\r\n\t\tvar user_list = this.state.user_list;\r\n\t\tvar chat_text = this.state.chat_text;\r\n\t\tvar chat_class;\r\n\r\n\t\tif (this.typeChat=='textChat') \r\n\t\t\tchat_class='chat_container';\r\n\t\telse\r\n\t\t\tchat_class='video_chat_container';\r\n\r\n\t\tif (this.state.isChat=='show') {\r\n\t\t\tchat_class += ' animate__animated animate__bounceInLeft';\r\n\t\t} \r\n\t\tif (this.state.isChat=='close') {\r\n\t\t\tchat_class += ' animate__animated animate__rotateOut';\r\n\t\t}\r\n\t\t(this.state.state_class=='state_indicator_on')?state_msg = 'Соединение активно':state_msg = 'Соединение не активно';\r\n\t\t(this.state.state_class=='state_indicator_on')?state_msg2 = 'Активно':state_msg2 = 'Не активно';\r\n\r\n\t\tif (this.typeChat=='textChat') {\r\n\t\t\t\r\n\t\t\tchatbox = <div className='modal_chat'>\r\n\t\t\t\t\t\t<div className={chat_class} onAnimationEnd={this.AnimationEnd}>\r\n\t\t\t\t\t\t\t<div className='chat_upper_panel'>\r\n\t\t\t\t\t\t\t\t<div className='upper_panel_name'>Текстовый чат</div>\r\n\t\t\t\t\t\t\t\t<div className='upper_panel_close' onClick={this.chatClose}>\r\n\t\t\t\t\t\t\t\t\t<div className='button_close'>X</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t        \t\t<div className='chat_header_container'>\r\n\t\t\t        \t\t\t<div className='chat_head'>Чат</div>\r\n\t\t\t        \t\t\t<div className='users_head'>Пользователи</div>\r\n\t\t\t        \t\t</div>\r\n\t\t\t        \t\t<div className='chat_box_container'>\r\n\t\t\t        \t\t\t<div className='chat_head_'>Чат</div>\r\n\t\t\t        \t\t\t<ChatBox>{chat_text}</ChatBox>\r\n\t\t\t        \t\t\t<div className='users_head_'>Пользователи</div>\r\n\t\t\t        \t\t\t<UserListBox>{user_list}</UserListBox>\r\n\t\t\t        \t\t</div>\r\n\t\t\t        \t\t<div className='chat_controls_container'>\t\t\t        \t\t\t\r\n\t\t\t        \t\t\t<fieldset className='state_network'>\r\n   \t\t\t\t\t\t\t\t\t<legend>Состояние сети</legend>\r\n   \t\t\t\t\t\t\t\t\t<div className='state_block'>\r\n   \t\t\t\t\t\t\t\t\t\t<div id='st1'>Чат:</div><div className={this.state.state_class}></div><div>{state_msg}</div>\r\n   \t\t\t\t\t\t\t\t\t</div>\r\n   \t\t\t\t\t\t\t\t\t<div className='state_control'>\r\n   \t\t\t\t\t\t\t\t\t\t<input type=\"button\" name=\"socketReconnect\" value=\"Reconnect chat\" id='reconnect' \r\n\t\t\t\t\t\t\t\t\t   \t\tonClick={()=>{\r\n\t\t\t\t\t\t\t\t\t   \t\t\tif (this.checkNetwork) \r\n\t\t\t\t\t\t\t\t\t   \t\t\t\tclearTimeout(this.checkNetwork);\r\n\t\t\t\t\t\t\t\t\t   \t\t\tthis.checkNetwork = null;\r\n\t\t\t\t\t\t\t\t\t   \t\t\tthis.setState({Msg:'Сбросить текущее websocket соединение и установить заново?'});\r\n\t\t\t\t\t\t\t\t\t   \t\t}} />\r\n   \t\t\t\t\t\t\t\t\t</div>\r\n   \t\t\t\t\t\t\t\t</fieldset>\r\n\t\t\t        \t\t\t<div className='send_controls'>\r\n\t\t\t        \t\t\t\t<input type=\"text\" name=\"text\" size=\"100\" maxLength=\"256\" value={this.state.input_text} onChange={this.onChangeText} placeholder=\"Здесь набирается текст ...\" \r\n\t\t\t\t\t\t\t\t\t  \tid=\"text_chat\" autoComplete=\"off\" onKeyUp={this.handlerKey} disabled={this.isControlsDisabled} />\r\n\t\t\t\t\t\t\t\t\t<input type=\"button\" name=\"send\" value=\"Send\" id=\"send\" onClick={this.onClickSend} disabled={this.isControlsDisabled} />\r\n\t\t\t        \t\t\t</div>\r\n\t\t\t        \t\t</div>\r\n\t\t\t        \t</div>\r\n\t\t\t\t\t  </div>;\r\n\r\n\t\t}\t \r\n\t\tif (this.typeChat=='videoChat') {\r\n\t\t\t\r\n\t\t\tvar dock_panel_class = 'video_dock_panel';\r\n\t\t\tvar localStyle = null;\r\n\r\n\t\t\tif (this.state.isDockPanel && this.state.isDockPanel!=' ') {\r\n\t\t\t\t(this.state.isDockPanel=='undock')?dock_panel_class+=' animate__animated animate__backOutUp':dock_panel_class+=' animate__animated animate__bounceInDown';\r\n\t\t\t}\r\n\t\t\tif (this.state.localVideo.width && this.state.localVideo.height) {\r\n\r\n\t\t\t\tvar strWidth = this.state.localVideo.width+'px';\r\n\t\t\t\tvar strHeight = this.state.localVideo.height+'px';\r\n\r\n\t\t\t\tlocalStyle = {width:strWidth,height:strHeight};\r\n\t\t\t}\r\n\r\n\t\t\tvar dock_panel = <div className={dock_panel_class} onAnimationEnd={this.AnimationEndDock}>\r\n\t\t\t\t\t\t\t\t<fieldset className='video_control_block'>\r\n\t\t\t\t\t\t\t\t\t<legend>Состояние сети</legend>\r\n\t\t\t\t\t\t\t\t\t<div className='button_network' \r\n\t\t\t\t\t\t\t\t\t\tonClick={()=>{\r\n\t\t\t\t\t\t\t\t\t\t\tif (this.checkNetwork) \r\n\t\t\t\t\t\t\t\t\t   \t\t\tclearTimeout(this.checkNetwork);\r\n\t\t\t\t\t\t\t\t\t   \t\tthis.checkNetwork = null;\r\n\t\t\t\t\t\t\t\t\t\t\tthis.setState({Msg:'Сбросить текущее websocket соединение и установить заново?'});\r\n\t\t\t\t\t\t\t\t\t\t}}>\r\n\t\t\t\t\t\t\t\t\t\t<div className={this.state.state_class}></div><div id='st3'>{state_msg}</div><div id='st2'>{state_msg2}</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className='button_video_call' onClick={this.videoCall}>\r\n\t\t\t\t\t\t\t\t\t\t<img src='img/video_call.png' className='video_call'/>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className='button_hide_panel' onClick={this.undockVideoPanel}>\r\n\t\t\t\t\t\t\t\t\t\t<img src='img/undock_panel.png' className='video_undock_panel'/>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className='user_name_container'>\r\n\t\t\t\t\t\t\t\t\t\t<img src='img/abonent-26.png' />\r\n\t\t\t\t\t\t\t\t\t\t<span>{this.state.target_user}</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</fieldset>\r\n\t\t\t\t\t\t\t</div>;\r\n\r\n\t\t\tchatbox =  <div className='modal_chat'>\r\n\t\t\t\t\t\t\t<div className={chat_class} onAnimationEnd={this.AnimationEnd}>\r\n\t\t\t\t\t\t\t\t<div className='video_chat_upper_panel'>\r\n\t\t\t\t\t\t\t\t\t<div className='video_upper_panel_name'>Видео чат</div>\r\n\t\t\t\t\t\t\t\t\t<div className='video_control_panel'>\r\n\t\t\t\t\t\t\t\t\t\t<div className='full_local_video' onClick={this.setCamera}>\r\n\t\t\t\t\t\t\t\t\t\t\t<img src='img/full_local.png' className='local_camera_img' />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className='full_receive_video' onClick={()=>{this.onFullScreen(this.receiveVideo);}}>\r\n\t\t\t\t\t\t\t\t\t\t\t<img src='img/full_receive.png' className='full_receive_img' />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className='video_panel_close' onClick={this.dockVideoPanel}>\r\n\t\t\t\t\t\t\t\t\t\t\t<img src='img/panel_video.png' className='video_panel_dock' />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className='video_close' onClick={this.chatClose}>X</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className='video_container'>\r\n\t\t\t\t\t\t\t\t\t<video className='receive_video' autoPlay ref={(video)=>{this.receiveVideo = video;}} />\r\n\t\t\t\t\t\t\t\t\t<video id='local_video' style={localStyle} autoPlay muted ref={(video)=>{this.localVideo = video;}}/>\r\n\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\tthis.state.isDockPanel?dock_panel:null\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t   </div>;\r\n\t\t}\r\n\t\t\r\n\t\tvar msgBox = <MessageBox type='confirm' effect='backInLeft' render={(state)=>{this.setState ({Msg:null});this.ReconnectChat(state);}} effectOut='zoomOutRight'>{this.state.Msg}</MessageBox>;\r\n\t\tvar videoMsg = <MessageBox type='confirm' effect='backInLeft' render={(state)=>{this.setState ({videoMsg:null});this.reInvite(state);}} effectOut='zoomOutRight'>{this.state.videoMsg}</MessageBox>;\r\n\t\tvar closeMsg = <MessageBox type='confirm' effect='backInLeft' render={(state)=>{this.setState ({closeMsg:null});this.closeVideoChat(state);}} effectOut='zoomOutRight'>{this.state.closeMsg}</MessageBox>;\r\n\r\n\t\treturn(\r\n\t\t\t<div>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.state.isChat?chatbox:null\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t{\r\n\t    \t\t\tthis.state.Msg?msgBox:null\r\n\t    \t\t}\r\n\t    \t\t{\r\n\t    \t\t\tthis.state.videoMsg?videoMsg:null\r\n\t    \t\t}\r\n\t    \t\t{\r\n\t    \t\t\tthis.state.closeMsg?closeMsg:null\r\n\t    \t\t}\r\n\t    \t\t{\r\n\t    \t\t\tthis.state.alertMsg?<MessageBox type='alert' effect='rubberBand' render={()=>{this.setState({alertMsg:null})}} effectOut='rotateOut'>{this.state.alertMsg}</MessageBox>:null\r\n\t    \t\t}\t    \t\t\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default ChatContainer","import React, {Component} from 'react'\r\nimport {MessageBox} from './start'\r\nimport ChatContainer from './chat'\r\nimport {\r\n  isMobile,\r\n  isAndroid\r\n} from \"react-device-detect\";\r\nimport './css/trainer.css'\r\n\r\nfunction Passport(props) {\r\n\tfunction ClickPhoto(event) {\r\n\t\tprops.ClickPhoto(props.indexLevel,event.clientX,event.clientY);\r\n\t}\r\n\treturn <div className='passe-partout' onClick={ClickPhoto}>{props.children}</div>;\r\n}\r\n\r\nfunction BlockExercise(props) {\r\n\treturn <div className='block_main_ex'>{props.children}</div>;\r\n}\r\n\r\nfunction Equipments(props) {\r\n\treturn <div className='equipment'>{props.children}</div>;\r\n}\r\n\r\nfunction WrapColumn(props) {\r\n\treturn <div className='wrap_column'>{props.children}</div>;\r\n}\r\n\r\nfunction MainExercise(props) {\r\n\tvar level = props.indexLevel;\r\n\r\n\tfunction ShowPhoto() {\r\n\t\tprops.ShowPhoto (level,props.complex_photos[0],props.complex_details[0],props.src_video[0]);\r\n\t}\r\n\r\n\treturn <div className=\"exercise_name\" onClick={ShowPhoto}>{props.children}</div>\r\n}\r\n\r\nfunction AddExercise(props) {\r\n\tvar level = props.level;\r\n\tvar number = props.number;\r\n\tvar animation = props.animation;\r\n\tvar last_element = props.last;\r\n\r\n\tfunction ShowPhoto() {\r\n\t\tprops.ShowPhoto (level,props.complex_photos[number],props.complex_details[number],props.src_video[number]);\r\n\t}\r\n\r\n\tfunction Animationend() {\r\n\t\tprops.DeleteMoreExercises (level);//для мобильных устройств\r\n\t}\r\n\r\n\tif (animation == 'hide')\r\n\t\treturn <li onAnimationEnd={last_element?Animationend:null} className='animation_lists_hide'>{props.children}</li>;\r\n\treturn <li className='animation_lists_show' onClick={ShowPhoto} >{props.children}</li>;\r\n}\r\n\r\nfunction AlternativeExercises(props) {\r\n\r\n\tfunction getKey(str){\r\n      let key = 0;\r\n      for (let i = 0; i < str.length; i++) {\r\n        key += str.charCodeAt(i);\r\n      }\r\n      return key.toString();\r\n    }\r\n\r\n    var level = props.indexLevel;\r\n    var animation = props.animation;\r\n    const list = props.exercises;\r\n    var i = 0;\r\n    var last = list.length-1;\r\n\r\n    const items = list.map((exercise) => {\r\n      const key = getKey(exercise)\r\n\r\n      return <AddExercise \r\n      \t\t\tlast={i==last? true:false} level={level} number={i++} animation={animation} DeleteMoreExercises={props.DeleteMoreExercises} \r\n      \t\t \tShowPhoto={props.ShowPhoto} src_video={props.src_video} complex_photos={props.complex_photos} complex_details={props.complex_details} key={key}> \r\n      \t\t \t{exercise}\r\n      \t\t </AddExercise>;\r\n    });\r\n    items.splice (0,1);\r\n\r\n    return (<ul className=\"list_exercise\">{items}</ul>);\r\n}\r\n\r\nfunction CreateTrainComponents(props) {\r\n\tvar Exercises;\r\n\tvar rows=[];\r\n\tvar columns=[];\r\n\tvar complex = props.complex;\r\n\tvar photos = props.photos;\r\n\tvar details = props.details;\r\n\tvar buttonShow = props.buttonShow;\r\n\tvar moreExercises = props.moreExercises;\r\n\tvar key=0;\r\n\r\n\tphotos.map ((photo,index)=>  {\r\n\t\tlet passport = <Passport \r\n\t\t\t\t\t\t\tClickPhoto={props.ClickPhoto} indexLevel={index}>\r\n\t\t\t\t\t\t\t<img src={photo} className='photo_equip'/>\r\n\t\t\t\t\t\t\t<div className='info'>{details[index].rounds}x{details[index].reps}</div>\r\n\t\t\t\t\t   </Passport>;\r\n\t\tlet block = <BlockExercise>\r\n\t\t\t\t\t<ButtonShow onButtonShowHadler={props.onButtonShowHadler} indexLevel={index}>{buttonShow[index]}</ButtonShow>\r\n\t\t\t\t\t<MainExercise \r\n\t\t\t\t\t\tShowPhoto={props.ShowPhoto} src_video={complex.src_video[index]} complex_details={complex.details[index]} complex_photos={complex.photo_equip[index]} \r\n\t\t\t\t\t\tindexLevel={index}>{complex.exercise_name[index][0]}\r\n\t\t\t\t\t</MainExercise>\r\n\t\t\t\t\t</BlockExercise>;\r\n\t\tif (moreExercises[index]!=null)\r\n\t\t\tExercises = <AlternativeExercises \r\n\t\t\t\t\t\t\tDeleteMoreExercises={props.DeleteMoreExercises} animation={moreExercises[index]} indexLevel={index} src_video={complex.src_video[index]}\r\n\t\t\t\t\t\t\texercises={complex.exercise_name[index]} ShowPhoto={props.ShowPhoto} complex_details={complex.details[index]} complex_photos={complex.photo_equip[index]}\r\n\t\t\t\t\t\t/>\r\n\t\telse\r\n\t\t\tExercises = null;\r\n\t\tcolumns.push (<Equipments key={++key}>{passport}{block}{Exercises}</Equipments>);\r\n\t});\r\n\r\n\tvar prev = null;\r\n\tvar count = 0;\r\n\tcolumns.map((column) => {\r\n\t\t++count;\r\n\t\tif (!prev)\r\n\t\t\tprev = column;\r\n\t\tif (count==2) {\r\n\t\t\trows.push (<WrapColumn key={++key}>{prev}{column}</WrapColumn>);\r\n\t\t\tprev = null;\r\n\t\t\tcount = 0;\r\n\t\t}\t\t\t\r\n\t});\r\n\tif (prev)\r\n\t\trows.push (<WrapColumn key={++key}>{prev}</WrapColumn>);\r\n\r\n\treturn (<div>{rows}</div>);\r\n}\r\n\r\nclass ButtonShow extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.onChangeState = this.onChangeState.bind(this);\r\n\t}\r\n\r\n\tonChangeState(event) {\r\n\t\tvar level = this.props.indexLevel;\r\n\t\tthis.props.onButtonShowHadler (level);\r\n\t}\r\n\r\n\trender() {\r\n\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t\t<button className=\"button_list_ex\" onClick={this.onChangeState}><b>{this.props.children}</b></button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nclass HeadBar extends Component {\r\n\tconstructor(props) {\r\n      super(props);\r\n      this.state = {isMsg:null,isChatBox:false};\r\n      this.typeChat = '';\r\n      this.onClickPlay = this.onClickPlay.bind(this);\r\n      this.onChatBox = this.onChatBox.bind(this);\r\n      this.onVideoChatBox = this.onVideoChatBox.bind(this);\r\n      this.onFullScreen = this.onFullScreen.bind(this);\r\n    }\r\n\r\n    onFullScreen() {\r\n    \tvar doc = window.document;\r\n    \tvar docEl = doc.documentElement;\r\n\r\n    \tvar requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;\r\n    \tvar cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;\r\n\r\n    \tif(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {\r\n\t\t    requestFullScreen.call(docEl);\r\n\t\t}\r\n\t\telse {\r\n\t\t    cancelFullScreen.call(doc);\r\n\t\t}\r\n    }\r\n\r\n    onChatBox() {\r\n    \tthis.typeChat = 'textChat';\r\n    \tthis.setState ({isChatBox:true});\r\n    }\r\n\r\n    onVideoChatBox() {\r\n    \tthis.typeChat = 'videoChat';\r\n    \tthis.setState ({isChatBox:true});\r\n    }\r\n\r\n    onClickPlay() {\r\n    \tif (this.props.video==null)\r\n    \t\tthis.setState ({isMsg:'Сначала выберите упражнение для просмотра видео'});\r\n    \telse\r\n    \tif (this.props.video=='')\r\n    \t\tthis.setState ({isMsg:'Видеоролик не добавлен администратором'});\r\n    \telse\r\n    \t\tthis.props.PlayVideo();\r\n    }\r\n\r\n\trender() {\r\n\t\tvar controlScreen = null;\r\n\t\tvar player_class,class_webcam;\r\n\t\tvar player = this.props.player;\r\n\t\tvar user_name = this.props.user_name;\r\n\t\tvar ws_server = this.props.ws_server;\r\n\r\n\t\tif (isAndroid && isMobile)\r\n\t\t\tcontrolScreen=<div className='wrap_control' onClick={this.onFullScreen}><img className='fullScreen' src='img/full_scr.png'/></div>;\r\n\r\n\t\tif (player)\r\n\t\t{\t\r\n\t\t\t(player=='show')?player_class='video_player animation_player_show':player_class='video_player animation_player_hide';\r\n\t\t}else\r\n\t\t\tplayer_class = 'video_player';\r\n\r\n\t\treturn (\r\n\t\t\t<div className='header_back'>\r\n\t\t\t\t{\r\n\t\t\t\t\t(this.props.video!='')?\r\n\t\t\t\t\t\t<iframe src={this.props.video} className={player_class} title=\"YouTube video player\" allow=\"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" \r\n\t\t\t\t\t\tallowFullScreen/>:null\r\n\t\t\t\t}\r\n\t\t\t\t<div className=\"header\">\t\t\t\t\r\n\t\t\t\t\t<div className='controls_container'>\r\n\t\t\t\t\t\t<div className='wrap_control' onClick={this.onChatBox}><img className='chatBox' src='img/chat-box.png'/></div>\r\n\t\t\t\t\t\t<div className='wrap_control' onClick={this.onClickPlay}><img id='youtube' src='img/youtube.png'/></div>\r\n\t\t\t\t\t\t<div className='wrap_control' onClick={this.onVideoChatBox}><img className='webCam' src='img/webcam96_off.png'/></div>\r\n\t\t\t\t\t\t{controlScreen}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{\r\n    \t\t\t\tthis.state.isMsg?<MessageBox type='alert' effect='rubberBand' render={()=>{this.setState({isMsg:null})}} effectOut='rotateOut'>{this.state.isMsg}</MessageBox>:null\r\n    \t\t\t}\r\n    \t\t\t{\r\n    \t\t\t\tthis.state.isChatBox?<ChatContainer typeChat={this.typeChat} user_name={user_name} ws_server={ws_server} render={()=>{this.setState({isChatBox:null})}}/>:null\r\n    \t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t} \t   \t    \t\r\n}\r\n\r\nclass ToolTip extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {toolTip:null};\r\n\t\tthis.out = false;\r\n\t\tthis.tool_class='';\r\n\r\n\t\tthis.clickHandler = this.clickHandler.bind(this);\r\n\t\tthis.AnimationEnd = this.AnimationEnd.bind(this);\r\n\t}\r\n\r\n\tAnimationEnd() {\r\n\t\tif (this.out)\r\n\t\t\tthis.props.render();\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.tool_class = 'weight animate__animated animate__' + this.props.effect;\r\n\t\tthis.setState ({toolTip:true});\r\n\t}\r\n\r\n\tclickHandler () {\r\n\t\tthis.tool_class = 'weight animate__animated animate__' + this.props.effectOut;\r\n\t\tthis.out = true;\r\n\t\tthis.setState ({toolTip:true});\r\n\t}\r\n\r\n\trender () {\r\n\t\r\n\t\treturn (\r\n\t\t\t<div>\r\n\t\t\t{\r\n\t\t\t\tthis.state.toolTip?\r\n\t\t\t\t<div className={this.tool_class} style={{left:this.props.posX,top:this.props.posY}} onClick={this.clickHandler} onAnimationEnd={this.AnimationEnd}>\r\n\t\t\t\t\t<div className='weight_text'>{this.props.children}</div>\r\n\t\t\t\t</div>:null\r\n\t\t\t}\t\t\t\t\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nclass TrainExercise extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {photos:[],buttonShow:[],moreExercises:[],details:[],video:null,player:null,chat:null,headBarVisible:true,toolTip:false};\r\n\t\tthis.arrayVideo = [];\r\n\t\tthis.posX=0;\r\n\t\tthis.posY=0;\r\n\r\n\t\tthis.onButtonShowHadler = this.onButtonShowHadler.bind(this);\r\n\t\tthis.onChatHandler = this.onChatHandler.bind(this);\r\n\t\tthis.DeleteMoreExercises = this.DeleteMoreExercises.bind(this);\r\n\t\tthis.ShowPhoto = this.ShowPhoto.bind(this);\r\n\t\tthis.PlayVideo = this.PlayVideo.bind(this);\r\n\t\tthis.ClickPhoto = this.ClickPhoto.bind(this);\r\n\t}\r\n\r\n\tonChatHandler() {\r\n\t\tvar chat = this.state.chat;\r\n\t\r\n\t\tif (chat==null || chat=='hide')\t\r\n\t\t{\r\n\t\t\tchat = 'show';\r\n\t\t}\t\t\t\t\t\t\r\n\t\telse\r\n\t\t{\r\n\t\t\tchat = 'hide';\r\n\t\t}\r\n\t\tthis.setState ({chat:chat});\r\n\t}\r\n\r\n\tClickPhoto(index,posX,posY) {\r\n\t\tvar tooltip;\r\n\t\tvar video = this.arrayVideo[index];\r\n\r\n\t\tthis.posX = posX-100;\r\n\t\tthis.posY = posY-75;\r\n\t\tvideo==''?tooltip=false:tooltip=true;\r\n\t\tthis.setState ({video:video,toolTip:tooltip});\r\n\t}\r\n\r\n\tPlayVideo() {\r\n\t\tvar video = this.state.video;\r\n\t\tvar player = this.state.player;\r\n\r\n\t\tif (player==null || player=='hide')\r\n\t\t\tplayer = 'show';\r\n\t\telse\r\n\t\t\tplayer = 'hide';\r\n\t\tthis.setState ({player:player});\r\n\t}\r\n\r\n\tShowPhoto(index,photo,detail,src_video) {\r\n\t\tvar photos = this.state.photos;\r\n\t\tvar details = this.state.details;\r\n\r\n\t\tphotos[index] = photo;\r\n\t\tdetails[index] = detail;\r\n\t\tthis.arrayVideo[index] = src_video;\r\n\t\tthis.setState ({photos:photos,details:details,video:src_video});\r\n\t}\r\n\r\n\tDeleteMoreExercises(level) {\r\n\t\tvar moreExercises = this.state.moreExercises;\r\n\t\tvar photos = this.state.photos;\r\n\t\tvar details = this.state.details;\r\n\t\tvar complex = this.props.complex;\r\n\r\n\t\tmoreExercises[level] = null;\r\n\t\tphotos[level] = complex.photo_equip[level][0];\r\n\t\tdetails[level] = complex.details[level][0];\r\n\t\tthis.setState ({photos:photos,moreExercises:moreExercises,details:details});\r\n\t}\r\n\r\n\tonButtonShowHadler(level) {\r\n\t\tvar buttonShow = this.state.buttonShow;\r\n\t\tvar moreExercises = this.state.moreExercises;\r\n\t\tif (buttonShow[level]=='-')\r\n\t\t{\r\n\t\t\tbuttonShow[level] = '+';\r\n\t\t\tmoreExercises[level] = 'hide';\r\n\t\t}\r\n\t\telse \r\n\t\t{\r\n\t\t\tbuttonShow[level] = '-';\r\n\t\t\tmoreExercises[level] = 'show';\r\n\t\t}\r\n\r\n\t\tthis.setState ({buttonShow:buttonShow,moreExercises:moreExercises});\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tvar buttonShow = [];\r\n\t\tvar moreExercises = []; \r\n\t\tvar details = [];\r\n\t\tvar complex = this.props.complex;\r\n\r\n\t\tvar photos = complex.photo_equip.map((photos,index)=> {\r\n\t\t\tbuttonShow.push ('+');\r\n\t\t\tmoreExercises.push (null);\r\n\t\t\tdetails.push (complex.details[index][0]);\r\n\t\t\tthis.arrayVideo.push (complex.src_video[index][0]);\r\n\t\t\treturn photos[0];\r\n\t\t});\r\n\t\tthis.setState ({photos:photos,buttonShow:buttonShow,moreExercises:moreExercises,details:details});\r\n\t}\r\n\r\n\trender() {\r\n\t\tvar complex = this.props.complex;\r\n\t\tvar user_name = this.props.user_name;\r\n\t\tvar photos = this.state.photos;\r\n\t\tvar video = this.state.video;\r\n\t\tvar buttonShow = this.state.buttonShow;\r\n\t\tvar moreExercises = this.state.moreExercises;\r\n\t\tvar details = this.state.details;\r\n\t\tvar player = this.state.player;\r\n\t\r\n\t\treturn (\t\t\t\t\t\r\n\t\t\t<div>\t\t\t\t\r\n\t\t\t\t<HeadBar user_name={user_name} video={video} player={player} PlayVideo={this.PlayVideo} ws_server={this.props.ws_server} />\t\t\t\t\t\t\t\t\r\n\t\t\t\t<div className='full_wrap'>\t\t\t\t\t\r\n\t\t\t\t\t<CreateTrainComponents \r\n\t\t\t\t\t\tDeleteMoreExercises={this.DeleteMoreExercises} onButtonShowHadler={this.onButtonShowHadler} moreExercises={moreExercises} buttonShow={buttonShow} photos={photos} \r\n\t\t\t\t\t\tcomplex={complex} ShowPhoto={this.ShowPhoto} details={details} ClickPhoto={this.ClickPhoto} \r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<div className='empty' />\r\n\t\t\t\t</div>\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.state.toolTip?<ToolTip posX={this.posX} posY={this.posY} effect='rotateIn' effectOut='rotateOut' render={()=>{this.setState({toolTip:false});}}>\r\n\t\t\t\t\tДля просмотра ролика нажмите кнопку YouTube</ToolTip>:null\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\nexport default TrainExercise","import React, {Component} from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport TrainExercise from './trainer'\r\nimport {\r\n  isMobile,\r\n  isDesktop,\r\n  isIE,\r\n  isEdge\r\n} from \"react-device-detect\";\r\nimport './css/start.css'\r\nimport './css/landscape1000.css'\r\nimport './css/landscape.css'\r\n\r\nclass MessageBox extends Component {\r\n   constructor(props) {\r\n      super(props);\r\n      this.state = {showBox:false,boxPos:{}};\r\n      this.class_box = 'msg_box';\r\n      this.isCloseState = null;\r\n      this.isDownMouse = false;\r\n      this.delta = {};\r\n\r\n      this.AnimationEnd = this.AnimationEnd.bind(this);\r\n      this.ClickButton = this.ClickButton.bind(this);\r\n      this.handleMouseDown = this.handleMouseDown.bind(this);\r\n      this.handleMouseUp = this.handleMouseUp.bind(this);\r\n      this.handleMouseMove = this.handleMouseMove.bind(this);\r\n    }\r\n\r\n    AnimationEnd() { \r\n      this.class_box = 'msg_box';\r\n      if (this.isCloseState)\r\n        this.props.render(this.isCloseState);\r\n    }\r\n\r\n    componentDidMount() {\r\n      if (typeof this.props.effect!='undefined') {\r\n        this.class_box += ' animate__animated animate__' + this.props.effect;\r\n      }\r\n      this.setState ({showBox:true});\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n       if (this.isCloseState && (isIE || isEdge)) {\r\n          setTimeout (()=>{this.props.render(this.isCloseState);},1500);\r\n       }\r\n    }\r\n\r\n    ClickButton(event) {\r\n      if (typeof this.props.effectOut!='undefined') {\r\n\r\n        this.isCloseState = event.target.textContent;\r\n        this.class_box += ' animate__animated animate__' + this.props.effectOut;\r\n        this.setState ({showBox:true});\r\n\r\n      }else\r\n\r\n      this.props.render(event.target.textContent);\r\n    }\r\n\r\n    handleMouseDown(event) {\r\n      var rect=this.msgBox.getBoundingClientRect();\r\n      \r\n      this.delta = {left:event.clientX-rect.left,top:event.clientY-rect.top};\r\n      this.isDownMouse = true ; \r\n    }\r\n\r\n    handleMouseUp() {\r\n      this.isDownMouse = false ;\r\n    }\r\n\r\n    handleMouseMove(event) {\r\n      if (this.isDownMouse) {\r\n        var left = event.clientX-this.delta.left;\r\n        var top = event.clientY-this.delta.top;\r\n\r\n        this.class_box = 'msg_box1';\r\n        this.setState({boxPos:{left:left,top:top}});\r\n      }\r\n    }\r\n\r\n    render() {\r\n      var buttons,box;\r\n\r\n      if (this.props.type=='confirm') {\r\n\r\n        buttons = <div className='container_buttons'><button className='button_yes' onClick={this.ClickButton}>Да</button>\r\n                  <button className='button_no' onClick={this.ClickButton}>Нет</button></div>;  \r\n      } else\r\n        buttons = <div className='container_button'><button onClick={this.ClickButton}>Ok</button></div>;\r\n\r\n      box = <div className={this.class_box} style={this.state.boxPos} onAnimationEnd={this.AnimationEnd} ref={(box)=>{this.msgBox=box;}}>\r\n                <div className='upper_panel' onMouseDown={this.handleMouseDown} >Внимание</div>\r\n                <div className='container_text'>{this.props.children}</div>\r\n                {buttons}\r\n            </div>;\r\n\r\n      return(\r\n        <div className='modal' onMouseMove={this.handleMouseMove} onMouseUp={this.handleMouseUp}>\r\n        {\r\n          this.state.showBox?box:null\r\n        }\r\n        </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nclass ClipsAnimation extends Component {\r\n   constructor(props) {\r\n      super(props);\r\n      this.state = {arrayClips:[]};\r\n      this.arrayImage = [{front_video:'clips/1.mp4',back_video:'clips/6.mp4'},\r\n                         {front_video:'clips/2.mp4',back_video:'clips/7.mp4'},\r\n                         {front_video:'clips/3.mp4',back_video:'clips/8.mp4'},\r\n                         {front_video:'clips/4.mp4',back_video:'clips/9.mp4'},\r\n                         {front_video:'clips/5.mp4',back_video:'clips/10.mp4'},\r\n                         {front_video:'clips/1.mp4',back_video:'clips/6.mp4'}\r\n                        ];\r\n      this.animation = {reverseIn:'animate__flipInY',reverseOut:'animate__flipOutY',delayIn:'animate__delay-0s',delayOut:'animate__delay-0s'};                    \r\n      this.createClip = false;\r\n      this.front_video_reverse=null;\r\n      this.back_video_reverse=null;\r\n      this.indexReverse=0;//IE\r\n      this.arrayVideo = [];\r\n      this.lastVideo=null;\r\n      this.interval = null;\r\n\r\n      this.shiftClips = this.shiftClips.bind(this);\r\n      this.createArrayClips = this.createArrayClips.bind(this);\r\n      this.ReverseClip = this.ReverseClip.bind(this);\r\n      this.PlayVideo = this.PlayVideo.bind(this);\r\n      this.PlayVideo_ = this.PlayVideo_.bind(this); //IE\r\n      this.reInitClips = this.reInitClips.bind(this);\r\n    }\r\n\r\n    shiftClips() {\r\n      this.arrayImage.shift();\r\n      this.arrayImage[this.arrayImage.length] = this.arrayImage[0];\r\n\r\n      this.arrayVideo.forEach((video,index)=> {\r\n        var class_clip = 'animation_clip'+(index+1);\r\n        var list = video.classList;\r\n\r\n        for (var i = 0; i < list.length; i++) {\r\n          if (list[i].indexOf('animation_clip') != -1)\r\n            video.classList.remove (list[i]);\r\n        }\r\n\r\n        video.classList.remove(this.animation.reverseIn);\r\n        video.classList.remove(this.animation.delayIn);\r\n        \r\n        video.classList.add (class_clip);\r\n      });\r\n      this.lastVideo = this.arrayVideo.shift();     \r\n      this.arrayVideo[this.arrayVideo.length] = this.lastVideo;    \r\n\r\n      if ((isIE || isEdge) && isDesktop) {\r\n\r\n         this.interval = setTimeout (()=>{this.reInitClips();},3000);\r\n      }  \r\n    }\r\n\r\n    reInitClips() {\r\n      var last_index = this.arrayImage.length-1;            \r\n\r\n      this.arrayVideo[last_index].src = this.arrayImage[0].front_video;\r\n      this.arrayVideo.forEach((video,index)=> {\r\n        var list = video.classList;\r\n\r\n        for (var i = 0; i < list.length; i++) {\r\n          if (list[i].indexOf('clip') != -1 && list[i].startsWith('clip'))\r\n            video.classList.remove (list[i]);\r\n        }      \r\n        video.classList.add('clip'+(index+1));\r\n\r\n        for (var i = 0; i < list.length; i++) {\r\n          if (list[i].indexOf('animation_clip') != -1)\r\n            video.classList.remove (list[i]);\r\n        }\r\n      });\r\n\r\n      if ((isIE || isEdge) && isDesktop) {\r\n        this.PlayVideo_(this.indexReverse);\r\n      }\r\n    }\r\n\r\n    PlayVideo_(index) {\r\n  \r\n      this.interval = setTimeout (()=>{this.ReverseClip(index,this.animation.reverseOut, this.animation.delayOut);},10000);\r\n    }\r\n\r\n    PlayVideo(index) {\r\n      this.arrayVideo[index].play()\r\n        .then(()=> {\r\n            var promise = new Promise((myResolve)=> {\r\n\r\n            this.interval = setTimeout (()=>{myResolve();},10000);\r\n          })\r\n          .then(()=> {\r\n              var promise = new Promise((myResolve)=> {\r\n\r\n                this.arrayVideo[index].onanimationend = ()=> {                   \r\n                  myResolve();\r\n                };\r\n                this.ReverseClip(index,this.animation.reverseOut, this.animation.delayOut);\r\n\r\n              })\r\n              .then(()=> {\r\n                  var promise = new Promise((myResolve)=> {\r\n                    \r\n                    this.arrayVideo[index].onanimationend = ()=> {\r\n                      myResolve();\r\n                    };\r\n\r\n                    this.arrayImage[index].front_video = this.back_video_reverse;\r\n                    this.arrayImage[index].back_video = this.front_video_reverse;\r\n          \r\n                    this.arrayVideo[index].src = this.arrayImage[index].front_video;\r\n                                       \r\n                    this.ReverseClip(index,this.animation.reverseIn, this.animation.delayIn);\r\n                  })\r\n                  .then(()=> {\r\n                    this.arrayVideo[index].play()\r\n                      .then(()=> {\r\n                          var promise = new Promise((myResolve)=> {\r\n\r\n                          this.interval = setTimeout (()=>{myResolve();},10000);\r\n                        })\r\n                        .then(()=>{\r\n                           var promise = new Promise((myResolve)=> {\r\n\r\n                            this.arrayVideo[index].onanimationend = ()=> {\r\n                              myResolve();\r\n                            };\r\n                            var last_index = this.arrayImage.length-1;\r\n                            this.arrayVideo[last_index].src = this.arrayImage[0].front_video;\r\n                            this.shiftClips();\r\n                          })\r\n                          .then(()=> {\r\n                            this.reInitClips();\r\n                            this.PlayVideo(index);\r\n                          });\r\n                        });\r\n                      });\r\n                  });\r\n              });\r\n          });            \r\n        });\r\n    }\r\n\r\n    createArrayClips() {\r\n      var autoplay = false;\r\n      var loop = false; \r\n\r\n      if ((isIE || isEdge) && isDesktop) {\r\n          autoplay = true;\r\n          loop = true;\r\n      } \r\n\r\n       var arrayClips = this.arrayImage.map((img,index) => {\r\n        var class_clip = 'video_img clip'+(index+1)+' animate__animated';  \r\n        \r\n        return <video key={index} className={class_clip} autoPlay={autoplay} loop={loop} muted src={img.front_video} ref={(video)=>{this.video=video;this.arrayVideo[index]=this.video;}}/>;\r\n      });\r\n      this.createClip = true;\r\n      this.setState ({arrayClips:arrayClips});\r\n    }\r\n\r\n    ReverseClip(indexReverse,effect,delay) {\r\n      this.indexReverse = indexReverse;\r\n   \r\n      this.front_video_reverse = this.arrayImage[indexReverse].front_video;\r\n      this.back_video_reverse = this.arrayImage[indexReverse].back_video;\r\n\r\n      \r\n      this.arrayVideo[indexReverse].classList.remove(this.animation.reverseIn);\r\n      this.arrayVideo[indexReverse].classList.remove(this.animation.reverseOut);     \r\n      this.arrayVideo[indexReverse].classList.remove(this.animation.delayOut);\r\n      this.arrayVideo[indexReverse].classList.remove(this.animation.delayIn);\r\n\r\n      this.arrayVideo[indexReverse].classList.add(effect);\r\n      this.arrayVideo[indexReverse].classList.add(delay);\r\n\r\n       if ((isIE || isEdge) && isDesktop) {\r\n        if (effect.indexOf('Out') != -1) {\r\n\r\n          this.arrayImage[this.indexReverse].front_video = this.back_video_reverse;\r\n          this.arrayImage[this.indexReverse].back_video = this.front_video_reverse;\r\n          \r\n          this.interval = setTimeout (()=>{\r\n\r\n            this.arrayVideo[this.indexReverse].src = this.arrayImage[this.indexReverse].front_video;\r\n            \r\n          },500);\r\n          this.interval = setTimeout (()=>{\r\n            \r\n            this.ReverseClip(indexReverse,this.animation.reverseIn,this.animation.delayIn);\r\n            \r\n          },1000);\r\n\r\n        } else {\r\n\r\n          var last_index = this.arrayImage.length-1;\r\n\r\n          this.arrayVideo[last_index].src = this.arrayImage[0].front_video;\r\n          this.interval = setTimeout (()=>{this.shiftClips();},10000);\r\n        }\r\n       }\r\n    }\r\n\r\n    componentDidMount() {\r\n      if ((isIE || isEdge) && !isDesktop)\r\n        return;\r\n      this.createArrayClips();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n      if (!(isIE || isEdge)) {\r\n\r\n        this.arrayVideo.forEach((video,index)=> {\r\n          video.onanimationend = null;\r\n        });\r\n      }\r\n      \r\n      clearTimeout(this.interval);\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n      if (this.createClip) {\r\n\r\n        this.createClip = false;\r\n        if (isIE || isEdge) {\r\n          if (isDesktop)\r\n            this.PlayVideo_(0);//IE\r\n        }\r\n        else\r\n          this.PlayVideo(0); \r\n      }\r\n    }\r\n\r\n    render() {\r\n      return (\r\n        <div className='video_block'>                  \r\n          {\r\n            \r\n            this.state.arrayClips\r\n          }                   \r\n        </div>\r\n      );\r\n    }\r\n}\r\n\r\nfunction Lenta(props) {\r\n  var class_lenta;\r\n  var array_win = [];\r\n  var array_win_ = [];\r\n\r\n  for (var i = 0; i <= 34; i++) {\r\n    array_win.push(<div key={i} className='lenta_win'/>);\r\n  }\r\n  for (var i = 0; i <= 18; i++) {\r\n    array_win.push(<div key={i+35} className='lenta_win_'/>);\r\n  }\r\n\r\n  props.pos=='up'?class_lenta='lenta':class_lenta='lenta2';\r\n\r\n  return <div className={class_lenta}>{array_win}{array_win_}</div>;\r\n}\r\n\r\nfunction BackImage(props) {\r\n\tif (typeof props.width!='undefined' && typeof props.height!='undefined')\r\n\t\treturn <img src={props.photo_src} width={props.width} height={props.height} className={props.class_name} alt='' />\r\n\treturn <img src={props.photo_src} className={props.class_name} alt='' />\r\n}\r\n\r\nfunction AnimationText(props) {\r\n\treturn <div className={props.class_name} id={props.text_id}>{props.children}</div>;\r\n}\r\n\r\nfunction AnimationHead() {\r\n\treturn (\r\n\t\t<div className='name_head'>\r\n\t\t\t<AnimationText class_name='name_head1 animate__animated animate__bounceInLeft animate__delay-1s animate__slow' text_id='head_name1'>Тренер</AnimationText>\r\n\t\t\t<AnimationText class_name='name_head2 animate__animated animate__bounceInRight animate__delay-1s animate__slow' text_id='head_name2'>онлайн</AnimationText>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nfunction FormEntry(props) {\r\n\treturn (\r\n\t\t<div className={props.class_name} id={props.form_id}>\r\n\t\t\t<div className=\"my_logo\">Copyright Бойчук Ярослав</div>\r\n\t\t\t<InputsBlock onLogon={props.onLogon} onSaveData={props.onSaveData} isSaveData={props.isSaveData} />\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nclass InputsBlock extends Component {\r\n\t constructor(props) {\r\n      super(props);\r\n      this.state = {login: '', password: ''};\r\n\r\n      this.onChangeLogin = this.onChangeLogin.bind(this);\r\n      this.onChangePassword = this.onChangePassword.bind(this);\r\n      this.onClickHandler = this.onClickHandler.bind(this);     \r\n      this.handlerKey = this.handlerKey.bind(this);\r\n    }\r\n\r\n    onChangePassword(event){\r\n      this.setState({password: event.target.value});\r\n    }\r\n\r\n    onChangeLogin(event) {\r\n      this.setState({login: event.target.value});\r\n    }\r\n\r\n    onClickHandler(event) {     \r\n   \t  this.props.onLogon ({user_name:this.state.login,password:this.state.password});\r\n    }\r\n\r\n    handlerKey(event) {\r\n      if (event.keyCode === 13 || event.keyCode === 14) {\r\n\t\t  this.onClickHandler();\r\n\t  }\r\n}\r\n\r\n\trender() {\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"input_block\">\r\n\t\t\t\t<p><b>Введите имя пользователя:</b></p>\r\n\t\t\t\t<input type=\"text\" id=\"usr\" value={this.state.login} onChange={this.onChangeLogin} />\r\n\t\t\t\t<p><b>Введите пароль:</b></p>\r\n\t\t\t\t<input type=\"password\" id=\"pass\" value={this.state.password} onChange={this.onChangePassword} onKeyUp={this.handlerKey} />\r\n\t\t\t\t<input type=\"button\" id=\"btn\" value=\"Подтвердить\" onClick={this.onClickHandler} />\r\n\t\t\t\t<p><input type=\"checkbox\" checked={this.props.isSaveData} id=\"chk\" onChange={this.props.onSaveData} /><span><b>Сохранить данные</b></span></p>            \r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nfunction Logon(props) {\r\n  var class_logon = 'logon_container';\r\n\r\n  if (isMobile)\r\n      class_logon += ' animate__animated animate__backInLeft';\r\n\treturn (    \r\n      <div className='back'>\t   \t\r\n      \t<div className={class_logon}>\r\n  \t    \t<AnimationHead />\r\n  \t    \t<FormEntry form_id='frm0' class_name='frame' onLogon={props.onLogon} onSaveData={props.onSaveData} isSaveData={props.isSaveData} />          \r\n      \t</div>        \r\n        <Lenta pos='up'/>\r\n        <ClipsAnimation />\r\n        <Lenta pos='down'/>      \r\n      </div>\r\n    );\r\n}\r\n\r\nclass Start extends Component {\r\n\tconstructor(props) {\r\n      super(props);\r\n      this.state = {showLogon:false,isSaveData:true,isMsg:false};\r\n\r\n      this.user_exist=false;\r\n      this.users = null;\r\n      this.agentInfo = '';\r\n\r\n      this.onLogon = this.onLogon.bind(this);\r\n      this.onStateLogon = this.onStateLogon.bind(this);\r\n      this.onSaveData = this.onSaveData.bind(this);\r\n      this.checkCookie = this.checkCookie.bind(this);\r\n      this.CheckUser = this.CheckUser.bind(this);    \r\n      this.setCookie = this.setCookie.bind(this);\r\n      this.getCookie = this.getCookie.bind(this);\r\n      this.getConfig = this.getConfig.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    var account = this.checkCookie();\r\n    \r\n  \tif (!account)\r\n  \t\tthis.onStateLogon(true);\r\n  \telse     \r\n      this.CheckUser(account);\r\n  }\r\n\r\n  CheckUser(account) {\r\n\r\n    fetch('json/users.json')\r\n      .then((result) => result.json())\r\n      .then((result) => {\r\n\r\n        this.users = result;\r\n        var i = this.users.usr_name.findIndex ( (name)=> {return name==account.user_name;});\r\n\r\n        if (i!=-1 && this.users.usr_pass[i]==account.password) {\r\n\r\n          if (this.user_exist==false) {\r\n\r\n            if (this.state.isSaveData) {\r\n\r\n              this.setCookie(\"username\", account.user_name, 365);\r\n              this.setCookie(\"password\", account.password, 365);\r\n            }\r\n          }\r\n          \r\n          this.onStateLogon(false);\r\n\r\n          var conf_json = this.users.usr_conf[i];\r\n\r\n          if (conf_json !=null && conf_json !='') {\r\n\r\n            this.getConfig (conf_json,account.user_name,this.users.ws_server);\r\n          }          \r\n\r\n        }else {\r\n\r\n          if (this.user_exist==true) {\r\n\r\n            document.cookie = \"username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\r\n            document.cookie = \"password=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\r\n            this.user_exist = false;\r\n            this.onStateLogon(true);\r\n\r\n          }else {\r\n            \r\n            this.setState({isMsg:true});\r\n          }      \r\n        }      \r\n      });    \r\n  }\r\n  \r\n  getConfig(config,user,ws_server) {\r\n    var complex,ws_server;\r\n    var xhttp = new XMLHttpRequest();\r\n\r\n    xhttp.onreadystatechange = ()=> {\r\n      if (xhttp.readyState == 4 && xhttp.status == 200) {\r\n          complex = JSON.parse(xhttp.responseText);  \r\n \r\n          this.props.render('none');\r\n          ReactDOM.render(\r\n            <TrainExercise complex={complex} user_name={user} ws_server={ws_server} />,\r\n            document.getElementById('wrap')\r\n          );\r\n      }\r\n    };\r\n    xhttp.open(\"GET\", config, true);\r\n    xhttp.send();\r\n  }\r\n\r\n  checkCookie() {\r\n    var account = {user_name:'',password:''};\r\n\r\n    account.password=this.getCookie(\"password\");\r\n    account.user_name=this.getCookie(\"username\");\r\n\r\n    this.user_exist=false;\r\n    \r\n    if (account.user_name != \"\") {\r\n        if (account.password == \"\")\r\n        {\r\n            return false;\r\n            //вывод формы на ввод\r\n        }else\r\n        {\r\n            this.user_exist=true;  \r\n            return account;       \r\n        }\r\n    } \r\n    return false;\r\n  }\r\n\r\n  setCookie(cname,cvalue,exdays) {\r\n    var d = new Date();\r\n\r\n    d.setTime(d.getTime() + (exdays*24*60*60*1000));\r\n    var expires = \"expires=\" + d.toGMTString();\r\n    document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\r\n  }\r\n\r\n  getCookie(cname) {\r\n    var name = cname + \"=\";\r\n    var decodedCookie = decodeURIComponent(document.cookie);\r\n    var ca = decodedCookie.split(';');\r\n\r\n    for(var i = 0; i < ca.length; i++) {\r\n      var c = ca[i];\r\n      while (c.charAt(0) == ' ') {\r\n        c = c.substring(1);\r\n      }\r\n      if (c.indexOf(name) == 0) {\r\n        return c.substring(name.length, c.length);\r\n      }\r\n    }\r\n    return \"\";\r\n  }\r\n\r\n  onStateLogon(state) {\r\n\r\n  \tthis.setState({showLogon:state})\r\n  }\r\n\r\n  onLogon(account) {\r\n  \tthis.CheckUser(account);\r\n  \r\n  }\r\n\r\n  onSaveData(event) {\r\n      this.setState(prevState => ({\r\n        isSaveData: !prevState.isSaveData\r\n      }));      \r\n  }\r\n\r\n  render() {\r\n    \r\n    if (!this.state.showLogon) {\r\n      return null;\r\n    }\r\n\r\n  \treturn (\r\n  \t\t<div style={{width:'100%',height:'100%'}}>\r\n  \t\t\t<Logon onLogon={this.onLogon} onSaveData={this.onSaveData} isSaveData={this.state.isSaveData} />\r\n        {\r\n          this.state.isMsg?<MessageBox type='alert' effect='zoomInDown' render={()=>{this.setState({isMsg:false})}} effectOut='zoomOutDown'>Имя пользователя или пароль не верны</MessageBox>:null\r\n\r\n        }  \r\n  \t\t</div>\r\n  \t);\r\n  }\r\n}\r\n\r\nexport {Start,MessageBox}\r\n\r\n","import 'react-app-polyfill/ie9';\nimport 'react-app-polyfill/stable';\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport {Start} from './start'\n\nReactDOM.render(\n  <Start render={(state)=>{document.getElementById('logon').style.display=state;}} />,\n  document.getElementById('logon')\n);\n"],"sourceRoot":""}